"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/company-incorporation/draft/route";
exports.ids = ["app/api/company-incorporation/draft/route"];
exports.modules = {

/***/ "@prisma/client":
/*!*********************************!*\
  !*** external "@prisma/client" ***!
  \*********************************/
/***/ ((module) => {

module.exports = require("@prisma/client");

/***/ }),

/***/ "../../client/components/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "../../client/components/request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "../../client/components/static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("crypto");

/***/ }),

/***/ "node:crypto":
/*!******************************!*\
  !*** external "node:crypto" ***!
  \******************************/
/***/ ((module) => {

module.exports = require("node:crypto");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcompany-incorporation%2Fdraft%2Froute&page=%2Fapi%2Fcompany-incorporation%2Fdraft%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcompany-incorporation%2Fdraft%2Froute.ts&appDir=%2FUsers%2Fphraewaphuriyaphan%2FDesktop%2FSynergy_updatedform%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fphraewaphuriyaphan%2FDesktop%2FSynergy_updatedform&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcompany-incorporation%2Fdraft%2Froute&page=%2Fapi%2Fcompany-incorporation%2Fdraft%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcompany-incorporation%2Fdraft%2Froute.ts&appDir=%2FUsers%2Fphraewaphuriyaphan%2FDesktop%2FSynergy_updatedform%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fphraewaphuriyaphan%2FDesktop%2FSynergy_updatedform&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_phraewaphuriyaphan_Desktop_Synergy_updatedform_app_api_company_incorporation_draft_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/company-incorporation/draft/route.ts */ \"(rsc)/./app/api/company-incorporation/draft/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/company-incorporation/draft/route\",\n        pathname: \"/api/company-incorporation/draft\",\n        filename: \"route\",\n        bundlePath: \"app/api/company-incorporation/draft/route\"\n    },\n    resolvedPagePath: \"/Users/phraewaphuriyaphan/Desktop/Synergy_updatedform/app/api/company-incorporation/draft/route.ts\",\n    nextConfigOutput,\n    userland: _Users_phraewaphuriyaphan_Desktop_Synergy_updatedform_app_api_company_incorporation_draft_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/company-incorporation/draft/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZjb21wYW55LWluY29ycG9yYXRpb24lMkZkcmFmdCUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGY29tcGFueS1pbmNvcnBvcmF0aW9uJTJGZHJhZnQlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZjb21wYW55LWluY29ycG9yYXRpb24lMkZkcmFmdCUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRnBocmFld2FwaHVyaXlhcGhhbiUyRkRlc2t0b3AlMkZTeW5lcmd5X3VwZGF0ZWRmb3JtJTJGYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj0lMkZVc2VycyUyRnBocmFld2FwaHVyaXlhcGhhbiUyRkRlc2t0b3AlMkZTeW5lcmd5X3VwZGF0ZWRmb3JtJmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDYztBQUNrRDtBQUMvSDtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFpRTtBQUN6RTtBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ3VIOztBQUV2SCIsInNvdXJjZXMiOlsid2VicGFjazovL215LXYwLXByb2plY3QvP2UzY2UiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiL1VzZXJzL3BocmFld2FwaHVyaXlhcGhhbi9EZXNrdG9wL1N5bmVyZ3lfdXBkYXRlZGZvcm0vYXBwL2FwaS9jb21wYW55LWluY29ycG9yYXRpb24vZHJhZnQvcm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2NvbXBhbnktaW5jb3Jwb3JhdGlvbi9kcmFmdC9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2NvbXBhbnktaW5jb3Jwb3JhdGlvbi9kcmFmdFwiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvY29tcGFueS1pbmNvcnBvcmF0aW9uL2RyYWZ0L3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiL1VzZXJzL3BocmFld2FwaHVyaXlhcGhhbi9EZXNrdG9wL1N5bmVyZ3lfdXBkYXRlZGZvcm0vYXBwL2FwaS9jb21wYW55LWluY29ycG9yYXRpb24vZHJhZnQvcm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL2NvbXBhbnktaW5jb3Jwb3JhdGlvbi9kcmFmdC9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcompany-incorporation%2Fdraft%2Froute&page=%2Fapi%2Fcompany-incorporation%2Fdraft%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcompany-incorporation%2Fdraft%2Froute.ts&appDir=%2FUsers%2Fphraewaphuriyaphan%2FDesktop%2FSynergy_updatedform%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fphraewaphuriyaphan%2FDesktop%2FSynergy_updatedform&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/company-incorporation/draft/route.ts":
/*!******************************************************!*\
  !*** ./app/api/company-incorporation/draft/route.ts ***!
  \******************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   dynamic: () => (/* binding */ dynamic),\n/* harmony export */   runtime: () => (/* binding */ runtime)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_auth__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/auth */ \"(rsc)/./lib/auth.ts\");\n/* harmony import */ var _lib_prisma__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/prisma */ \"(rsc)/./lib/prisma.ts\");\n/* harmony import */ var _lib_orders__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/lib/orders */ \"(rsc)/./lib/orders.ts\");\n/* harmony import */ var _lib_prospects__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! @/lib/prospects */ \"(rsc)/./lib/prospects.ts\");\n// app/api/company-incorporation/draft/route.ts\n\n\n\n\n\nconst runtime = \"nodejs\";\nconst dynamic = \"force-dynamic\";\nfunction asDateOrNull(v) {\n    if (!v) return null;\n    if (v instanceof Date) return v;\n    const d = new Date(String(v));\n    return isNaN(d.getTime()) ? null : d;\n}\nfunction jsonOr(defaultVal) {\n    return (val)=>val === undefined ? defaultVal : val;\n}\nconst jsonOrObj = jsonOr({});\nconst jsonOrArr = jsonOr([]);\nasync function POST(request) {\n    try {\n        const session = await (0,_lib_auth__WEBPACK_IMPORTED_MODULE_1__.auth)();\n        if (!session?.user?.id || !session.user.email) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Unauthorized\"\n            }, {\n                status: 401\n            });\n        }\n        const body = await request.json().catch(()=>null);\n        if (!body) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Invalid JSON body\"\n            }, {\n                status: 400\n            });\n        }\n        const { onboardingId, status = \"draft\", ...formData } = body;\n        if (!onboardingId) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"onboardingId is required\"\n            }, {\n                status: 400\n            });\n        }\n        // Ensure the onboarding exists (prevents FK errors)\n        const onboarding = await _lib_prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.clientOnboarding.findUnique({\n            where: {\n                id: onboardingId\n            },\n            select: {\n                id: true,\n                userId: true\n            }\n        });\n        if (!onboarding) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Invalid onboardingId (not found)\"\n            }, {\n                status: 400\n            });\n        }\n        // Pull out scalars / JSON\n        const { // signature / verification\n        signatureType, signatureFilePath, signatureFileName, completedByName, signedAt, ipAddress, userAgent, // simple scalars\n        jurisdiction, purposeOfCompany, geographicProfile, authorizedShares, sharesParValue, currency, customShares, customParValue, complexStructureNotes, orderSeal, sealQuantity, requiresNomineeShareholder, requiresNomineeDirector, // JSON-like\n        companyNames, relevantIndividuals, sourceOfFunds, recordsLocation, declaration, shareholders, directors, // ignore unknown keys safely\n        ..._restIgnored } = formData;\n        // derive runtime client info if not sent\n        const inferredIp = ipAddress || request.headers.get(\"x-forwarded-for\")?.split(\",\")[0]?.trim() || null;\n        const inferredUA = userAgent || request.headers.get(\"user-agent\") || null;\n        // server-side signedAt: if there’s a signature and no timestamp, stamp now\n        const signedAtServer = asDateOrNull(signedAt) ?? (signatureType ? new Date() : null);\n        // Registered office fee logic\n        const needsRegisteredOffice = Boolean(sourceOfFunds?.needsRegisteredOffice);\n        const officeLocation = needsRegisteredOffice ? null : sourceOfFunds?.officeLocation ?? null;\n        const registeredOfficeFeeHKD = needsRegisteredOffice ? 1500 : 0;\n        // Build safe data for Prisma (never write undefined into JSON columns)\n        const prismaData = {\n            // JSON columns\n            companyNames: jsonOrObj(companyNames),\n            relevantIndividuals: jsonOrArr(relevantIndividuals),\n            sourceOfFunds: jsonOrObj(sourceOfFunds),\n            recordsLocation: jsonOrObj(recordsLocation),\n            declaration: jsonOrObj(declaration),\n            // arrays / booleans\n            requiresNomineeShareholder: !!requiresNomineeShareholder,\n            shareholders: jsonOrArr(shareholders),\n            requiresNomineeDirector: !!requiresNomineeDirector,\n            directors: jsonOrArr(directors),\n            // Simple fields with fallbacks\n            purposeOfCompany: purposeOfCompany ?? \"\",\n            geographicProfile: geographicProfile ?? \"\",\n            authorizedShares: authorizedShares ?? \"50000\",\n            sharesParValue: sharesParValue ?? \"1.00\",\n            currency: currency ?? \"USD\",\n            customShares: customShares ?? \"\",\n            customParValue: customParValue ?? \"\",\n            complexStructureNotes: complexStructureNotes ?? \"\",\n            orderSeal: orderSeal ?? true,\n            sealQuantity: sealQuantity ?? \"1\",\n            jurisdiction: jurisdiction ?? \"BVI\",\n            // Registered office derived fields\n            needsRegisteredOffice,\n            officeLocation,\n            registeredOfficeFeeHKD,\n            // Signature / verification\n            completedByName: completedByName ?? null,\n            signatureType: signatureType ?? null,\n            signatureFilePath: signatureFilePath ?? null,\n            signatureFileName: signatureFileName ?? null,\n            signedAt: signedAtServer,\n            ipAddress: inferredIp,\n            userAgent: inferredUA,\n            status,\n            updatedAt: new Date()\n        };\n        // Upsert by onboardingId\n        const draft = await _lib_prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.companyIncorporation.upsert({\n            where: {\n                onboardingId\n            },\n            create: {\n                onboardingId,\n                ...prismaData\n            },\n            update: prismaData,\n            select: {\n                onboardingId: true,\n                jurisdiction: true,\n                companyNames: true,\n                signedAt: true\n            }\n        });\n        // ---- Prospect + email side-effects (non-fatal) ----\n        let didProspect = false;\n        let didEmail = false;\n        try {\n            // Prefer body’s firstPref (latest), fallback to DB snapshot\n            const bodyFirstPref = companyNames && typeof companyNames === \"object\" ? companyNames?.firstPreference : undefined;\n            const dbFirstPref = draft.companyNames && typeof draft.companyNames === \"object\" ? draft.companyNames?.firstPreference : undefined;\n            const firstPref = (bodyFirstPref || dbFirstPref)?.toString()?.trim();\n            console.log(\"[draft] companyNames incoming =\", companyNames);\n            console.log(\"[draft] companyNames stored   =\", draft.companyNames);\n            console.log(\"[draft] extracted firstPref  =\", firstPref);\n            if (firstPref) {\n                // 1) Upsert Prospect\n                await (0,_lib_prospects__WEBPACK_IMPORTED_MODULE_4__.upsertProspect)({\n                    userId: onboarding.userId,\n                    onboardingId: draft.onboardingId,\n                    jurisdiction: draft.jurisdiction || \"BVI\",\n                    rawName: firstPref\n                });\n                didProspect = true;\n                console.log(\"[draft] upsertProspect OK\");\n                // 2) Ensure pending order + (simulate) email\n                const appUrl = \"http://localhost:3000\" || 0 || 0;\n                const pricingUrl = `${appUrl}/pricing?onboardingId=${draft.onboardingId}`;\n                const emailRes = await (0,_lib_orders__WEBPACK_IMPORTED_MODULE_3__.ensurePendingOrder)({\n                    userId: onboarding.userId,\n                    userEmail: session.user.email,\n                    onboardingId: draft.onboardingId,\n                    jurisdiction: draft.jurisdiction || \"BVI\",\n                    companyNames: draft.companyNames,\n                    pricingUrl\n                });\n                didEmail = true;\n                console.log(\"[draft] ensurePendingOrder OK\", emailRes);\n            } else {\n                console.log(\"[draft] firstPreference missing — Prospect & email skipped.\");\n            }\n        } catch (sideFxErr) {\n            console.warn(\"[draft] side-effects warning (prospect/email):\", sideFxErr);\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            ok: true,\n            data: draft,\n            didProspect,\n            didEmail\n        });\n    } catch (err) {\n        const code = err?.code;\n        if (code === \"P2003\") {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Foreign key constraint failed. Check onboardingId.\"\n            }, {\n                status: 400\n            });\n        }\n        if (code === \"P2002\") {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Unique constraint failed.\"\n            }, {\n                status: 400\n            });\n        }\n        console.error(\"[Save draft] Unhandled error:\", err);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Failed to save draft\"\n        }, {\n            status: 500\n        });\n    }\n}\nasync function GET(request) {\n    try {\n        const session = await (0,_lib_auth__WEBPACK_IMPORTED_MODULE_1__.auth)();\n        if (!session?.user?.email) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Unauthorized\"\n            }, {\n                status: 401\n            });\n        }\n        const { searchParams } = new URL(request.url);\n        const onboardingId = searchParams.get(\"onboardingId\");\n        if (!onboardingId) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"onboardingId is required\"\n            }, {\n                status: 400\n            });\n        }\n        const draft = await _lib_prisma__WEBPACK_IMPORTED_MODULE_2__.prisma.companyIncorporation.findUnique({\n            where: {\n                onboardingId\n            }\n        });\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            ok: true,\n            data: draft || null\n        });\n    } catch (error) {\n        console.error(\"Load draft error:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Failed to load draft\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL2NvbXBhbnktaW5jb3Jwb3JhdGlvbi9kcmFmdC9yb3V0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBQSwrQ0FBK0M7QUFDUTtBQUN0QjtBQUNJO0FBQ1k7QUFDRDtBQUV6QyxNQUFNSyxVQUFVLFNBQVE7QUFDeEIsTUFBTUMsVUFBVSxnQkFBZTtBQUV0QyxTQUFTQyxhQUFhQyxDQUFVO0lBQzlCLElBQUksQ0FBQ0EsR0FBRyxPQUFPO0lBQ2YsSUFBSUEsYUFBYUMsTUFBTSxPQUFPRDtJQUM5QixNQUFNRSxJQUFJLElBQUlELEtBQUtFLE9BQU9IO0lBQzFCLE9BQU9JLE1BQU1GLEVBQUVHLE9BQU8sTUFBTSxPQUFPSDtBQUNyQztBQUNBLFNBQVNJLE9BQVVDLFVBQWE7SUFDOUIsT0FBTyxDQUFDQyxNQUFpQkEsUUFBUUMsWUFBWUYsYUFBYUM7QUFDNUQ7QUFDQSxNQUFNRSxZQUFZSixPQUE0QixDQUFDO0FBQy9DLE1BQU1LLFlBQVlMLE9BQWMsRUFBRTtBQUUzQixlQUFlTSxLQUFLQyxPQUFvQjtJQUM3QyxJQUFJO1FBQ0YsTUFBTUMsVUFBVSxNQUFNckIsK0NBQUlBO1FBQzFCLElBQUksQ0FBQ3FCLFNBQVNDLE1BQU1DLE1BQU0sQ0FBQ0YsUUFBUUMsSUFBSSxDQUFDRSxLQUFLLEVBQUU7WUFDN0MsT0FBT3pCLHFEQUFZQSxDQUFDMEIsSUFBSSxDQUFDO2dCQUFFQyxPQUFPO1lBQWUsR0FBRztnQkFBRUMsUUFBUTtZQUFJO1FBQ3BFO1FBRUEsTUFBTUMsT0FBTyxNQUFNUixRQUFRSyxJQUFJLEdBQUdJLEtBQUssQ0FBQyxJQUFNO1FBQzlDLElBQUksQ0FBQ0QsTUFBTTtZQUNULE9BQU83QixxREFBWUEsQ0FBQzBCLElBQUksQ0FBQztnQkFBRUMsT0FBTztZQUFvQixHQUFHO2dCQUFFQyxRQUFRO1lBQUk7UUFDekU7UUFFQSxNQUFNLEVBQUVHLFlBQVksRUFBRUgsU0FBUyxPQUFPLEVBQUUsR0FBR0ksVUFBVSxHQUFHSDtR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QUFJeEYsT0FBb0I7SUFDNUMsSUFBSTtRQUNGLE1BQU1DLFVBQVUsTUFBTXJCLCtDQUFJQTtRQUMxQixJQUFJLENBQUNxQixTQUFTQyxNQUFNRSxPQUFPO1lBQ3pCLE9BQU96QixxREFBWUEsQ0FBQzBCLElBQUksQ0FBQztnQkFBRUMsT0FBTztZQUFlLEdBQUc7Z0JBQUVDLFFBQVE7WUFBSTtRQUNwRTtRQUVBLE1BQU0sRUFBRWtGLFlBQVksRUFBRSxHQUFHLElBQUlDLElBQUkxRixRQUFRMkYsR0FBRztRQUM1QyxNQUFNakYsZUFBZStFLGFBQWF6QyxHQUFHLENBQUM7UUFDdEMsSUFBSSxDQUFDdEMsY0FBYztZQUNqQixPQUFPL0IscURBQVlBLENBQUMwQixJQUFJLENBQUM7Z0JBQUVDLE9BQU87WUFBMkIsR0FBRztnQkFBRUMsUUFBUTtZQUFJO1FBQ2hGO1FBRUEsTUFBTW9ELFFBQVEsTUFBTTlFLCtDQUFNQSxDQUFDK0Usb0JBQW9CLENBQUM5QyxVQUFVLENBQUM7WUFDekRDLE9BQU87Z0JBQUVMO1lBQWE7UUFDeEI7UUFFQSxPQUFPL0IscURBQVlBLENBQUMwQixJQUFJLENBQUM7WUFBRStFLElBQUk7WUFBTUMsTUFBTTFCLFNBQVM7UUFBSztJQUMzRCxFQUFFLE9BQU9yRCxPQUFPO1FBQ2RpRSxRQUFRakUsS0FBSyxDQUFDLHFCQUFxQkE7UUFDbkMsT0FBTzNCLHFEQUFZQSxDQUFDMEIsSUFBSSxDQUFDO1lBQUVDLE9BQU87UUFBdUIsR0FBRztZQUFFQyxRQUFRO1FBQUk7SUFDNUU7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL215LXYwLXByb2plY3QvLi9hcHAvYXBpL2NvbXBhbnktaW5jb3Jwb3JhdGlvbi9kcmFmdC9yb3V0ZS50cz8xZDE5Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIGFwcC9hcGkvY29tcGFueS1pbmNvcnBvcmF0aW9uL2RyYWZ0L3JvdXRlLnRzXG5pbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInXG5pbXBvcnQgeyBhdXRoIH0gZnJvbSAnQC9saWIvYXV0aCdcbmltcG9ydCB7IHByaXNtYSB9IGZyb20gJ0AvbGliL3ByaXNtYSdcbmltcG9ydCB7IGVuc3VyZVBlbmRpbmdPcmRlciB9IGZyb20gJ0AvbGliL29yZGVycydcbmltcG9ydCB7IHVwc2VydFByb3NwZWN0IH0gZnJvbSAnQC9saWIvcHJvc3BlY3RzJ1xuXG5leHBvcnQgY29uc3QgcnVudGltZSA9ICdub2RlanMnXG5leHBvcnQgY29uc3QgZHluYW1pYyA9ICdmb3JjZS1keW5hbWljJ1xuXG5mdW5jdGlvbiBhc0RhdGVPck51bGwodjogdW5rbm93bikge1xuICBpZiAoIXYpIHJldHVybiBudWxsXG4gIGlmICh2IGluc3RhbmNlb2YgRGF0ZSkgcmV0dXJuIHZcbiAgY29uc3QgZCA9IG5ldyBEYXRlKFN0cmluZyh2KSlcbiAgcmV0dXJuIGlzTmFOKGQuZ2V0VGltZSgpKSA/IG51bGwgOiBkXG59XG5mdW5jdGlvbiBqc29uT3I8VD4oZGVmYXVsdFZhbDogVCkge1xuICByZXR1cm4gKHZhbDogYW55KTogVCA9PiAodmFsID09PSB1bmRlZmluZWQgPyBkZWZhdWx0VmFsIDogdmFsKVxufVxuY29uc3QganNvbk9yT2JqID0ganNvbk9yPFJlY29yZDxzdHJpbmcsIGFueT4+KHt9KVxuY29uc3QganNvbk9yQXJyID0ganNvbk9yPGFueVtdPihbXSlcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aCgpXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyPy5pZCB8fCAhc2Vzc2lvbi51c2VyLmVtYWlsKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ1VuYXV0aG9yaXplZCcgfSwgeyBzdGF0dXM6IDQwMSB9KVxuICAgIH1cblxuICAgIGNvbnN0IGJvZHkgPSBhd2FpdCByZXF1ZXN0Lmpzb24oKS5jYXRjaCgoKSA9PiBudWxsKVxuICAgIGlmICghYm9keSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdJbnZhbGlkIEpTT04gYm9keScgfSwgeyBzdGF0dXM6IDQwMCB9KVxuICAgIH1cblxuICAgIGNvbnN0IHsgb25ib2FyZGluZ0lkLCBzdGF0dXMgPSAnZHJhZnQnLCAuLi5mb3JtRGF0YSB9ID0gYm9keVxuICAgIGlmICghb25ib2FyZGluZ0lkKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ29uYm9hcmRpbmdJZCBpcyByZXF1aXJlZCcgfSwgeyBzdGF0dXM6IDQwMCB9KVxuICAgIH1cblxuICAgIC8vIEVuc3VyZSB0aGUgb25ib2FyZGluZyBleGlzdHMgKHByZXZlbnRzIEZLIGVycm9ycylcbiAgICBjb25zdCBvbmJvYXJkaW5nID0gYXdhaXQgcHJpc21hLmNsaWVudE9uYm9hcmRpbmcuZmluZFVuaXF1ZSh7XG4gICAgICB3aGVyZTogeyBpZDogb25ib2FyZGluZ0lkIH0sXG4gICAgICBzZWxlY3Q6IHsgaWQ6IHRydWUsIHVzZXJJZDogdHJ1ZSB9LFxuICAgIH0pXG4gICAgaWYgKCFvbmJvYXJkaW5nKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdJbnZhbGlkIG9uYm9hcmRpbmdJZCAobm90IGZvdW5kKScgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApXG4gICAgfVxuXG4gICAgLy8gUHVsbCBvdXQgc2NhbGFycyAvIEpTT05cbiAgICBjb25zdCB7XG4gICAgICAvLyBzaWduYXR1cmUgLyB2ZXJpZmljYXRpb25cbiAgICAgIHNpZ25hdHVyZVR5cGUsXG4gICAgICBzaWduYXR1cmVGaWxlUGF0aCxcbiAgICAgIHNpZ25hdHVyZUZpbGVOYW1lLFxuICAgICAgY29tcGxldGVkQnlOYW1lLFxuICAgICAgc2lnbmVkQXQsXG4gICAgICBpcEFkZHJlc3MsXG4gICAgICB1c2VyQWdlbnQsXG5cbiAgICAgIC8vIHNpbXBsZSBzY2FsYXJzXG4gICAgICBqdXJpc2RpY3Rpb24sXG4gICAgICBwdXJwb3NlT2ZDb21wYW55LFxuICAgICAgZ2VvZ3JhcGhpY1Byb2ZpbGUsXG4gICAgICBhdXRob3JpemVkU2hhcmVzLFxuICAgICAgc2hhcmVzUGFyVmFsdWUsXG4gICAgICBjdXJyZW5jeSxcbiAgICAgIGN1c3RvbVNoYXJlcyxcbiAgICAgIGN1c3RvbVBhclZhbHVlLFxuICAgICAgY29tcGxleFN0cnVjdHVyZU5vdGVzLFxuICAgICAgb3JkZXJTZWFsLFxuICAgICAgc2VhbFF1YW50aXR5LFxuICAgICAgcmVxdWlyZXNOb21pbmVlU2hhcmVob2xkZXIsXG4gICAgICByZXF1aXJlc05vbWluZWVEaXJlY3RvcixcblxuICAgICAgLy8gSlNPTi1saWtlXG4gICAgICBjb21wYW55TmFtZXMsXG4gICAgICByZWxldmFudEluZGl2aWR1YWxzLFxuICAgICAgc291cmNlT2ZGdW5kcyxcbiAgICAgIHJlY29yZHNMb2NhdGlvbixcbiAgICAgIGRlY2xhcmF0aW9uLFxuICAgICAgc2hhcmVob2xkZXJzLFxuICAgICAgZGlyZWN0b3JzLFxuXG4gICAgICAvLyBpZ25vcmUgdW5rbm93biBrZXlzIHNhZmVseVxuICAgICAgLi4uX3Jlc3RJZ25vcmVkXG4gICAgfSA9IGZvcm1EYXRhXG5cbiAgICAvLyBkZXJpdmUgcnVudGltZSBjbGllbnQgaW5mbyBpZiBub3Qgc2VudFxuICAgIGNvbnN0IGluZmVycmVkSXAgPVxuICAgICAgaXBBZGRyZXNzIHx8XG4gICAgICByZXF1ZXN0LmhlYWRlcnMuZ2V0KCd4LWZvcndhcmRlZC1mb3InKT8uc3BsaXQoJywnKVswXT8udHJpbSgpIHx8XG4gICAgICBudWxsXG4gICAgY29uc3QgaW5mZXJyZWRVQSA9IHVzZXJBZ2VudCB8fCByZXF1ZXN0LmhlYWRlcnMuZ2V0KCd1c2VyLWFnZW50JykgfHwgbnVsbFxuXG4gICAgLy8gc2VydmVyLXNpZGUgc2lnbmVkQXQ6IGlmIHRoZXJl4oCZcyBhIHNpZ25hdHVyZSBhbmQgbm8gdGltZXN0YW1wLCBzdGFtcCBub3dcbiAgICBjb25zdCBzaWduZWRBdFNlcnZlciA9XG4gICAgICBhc0RhdGVPck51bGwoc2lnbmVkQXQpID8/IChzaWduYXR1cmVUeXBlID8gbmV3IERhdGUoKSA6IG51bGwpXG5cbiAgICAvLyBSZWdpc3RlcmVkIG9mZmljZSBmZWUgbG9naWNcbiAgICBjb25zdCBuZWVkc1JlZ2lzdGVyZWRPZmZpY2UgPSBCb29sZWFuKHNvdXJjZU9mRnVuZHM/Lm5lZWRzUmVnaXN0ZXJlZE9mZmljZSlcbiAgICBjb25zdCBvZmZpY2VMb2NhdGlvbiA9IG5lZWRzUmVnaXN0ZXJlZE9mZmljZVxuICAgICAgPyBudWxsXG4gICAgICA6IChzb3VyY2VPZkZ1bmRzPy5vZmZpY2VMb2NhdGlvbiA/PyBudWxsKVxuICAgIGNvbnN0IHJlZ2lzdGVyZWRPZmZpY2VGZWVIS0QgPSBuZWVkc1JlZ2lzdGVyZWRPZmZpY2UgPyAxNTAwIDogMFxuXG4gICAgLy8gQnVpbGQgc2FmZSBkYXRhIGZvciBQcmlzbWEgKG5ldmVyIHdyaXRlIHVuZGVmaW5lZCBpbnRvIEpTT04gY29sdW1ucylcbiAgICBjb25zdCBwcmlzbWFEYXRhID0ge1xuICAgICAgLy8gSlNPTiBjb2x1bW5zXG4gICAgICBjb21wYW55TmFtZXM6IGpzb25Pck9iaihjb21wYW55TmFtZXMpLFxuICAgICAgcmVsZXZhbnRJbmRpdmlkdWFsczoganNvbk9yQXJyKHJlbGV2YW50SW5kaXZpZHVhbHMpLFxuICAgICAgc291cmNlT2ZGdW5kczoganNvbk9yT2JqKHNvdXJjZU9mRnVuZHMpLFxuICAgICAgcmVjb3Jkc0xvY2F0aW9uOiBqc29uT3JPYmoocmVjb3Jkc0xvY2F0aW9uKSxcbiAgICAgIGRlY2xhcmF0aW9uOiBqc29uT3JPYmooZGVjbGFyYXRpb24pLFxuXG4gICAgICAvLyBhcnJheXMgLyBib29sZWFuc1xuICAgICAgcmVxdWlyZXNOb21pbmVlU2hhcmVob2xkZXI6ICEhcmVxdWlyZXNOb21pbmVlU2hhcmVob2xkZXIsXG4gICAgICBzaGFyZWhvbGRlcnM6IGpzb25PckFycihzaGFyZWhvbGRlcnMpLFxuICAgICAgcmVxdWlyZXNOb21pbmVlRGlyZWN0b3I6ICEhcmVxdWlyZXNOb21pbmVlRGlyZWN0b3IsXG4gICAgICBkaXJlY3RvcnM6IGpzb25PckFycihkaXJlY3RvcnMpLFxuXG4gICAgICAvLyBTaW1wbGUgZmllbGRzIHdpdGggZmFsbGJhY2tzXG4gICAgICBwdXJwb3NlT2ZDb21wYW55OiBwdXJwb3NlT2ZDb21wYW55ID8/ICcnLFxuICAgICAgZ2VvZ3JhcGhpY1Byb2ZpbGU6IGdlb2dyYXBoaWNQcm9maWxlID8/ICcnLFxuICAgICAgYXV0aG9yaXplZFNoYXJlczogYXV0aG9yaXplZFNoYXJlcyA/PyAnNTAwMDAnLFxuICAgICAgc2hhcmVzUGFyVmFsdWU6IHNoYXJlc1BhclZhbHVlID8/ICcxLjAwJyxcbiAgICAgIGN1cnJlbmN5OiBjdXJyZW5jeSA/PyAnVVNEJyxcbiAgICAgIGN1c3RvbVNoYXJlczogY3VzdG9tU2hhcmVzID8/ICcnLFxuICAgICAgY3VzdG9tUGFyVmFsdWU6IGN1c3RvbVBhclZhbHVlID8/ICcnLFxuICAgICAgY29tcGxleFN0cnVjdHVyZU5vdGVzOiBjb21wbGV4U3RydWN0dXJlTm90ZXMgPz8gJycsXG4gICAgICBvcmRlclNlYWw6IG9yZGVyU2VhbCA/PyB0cnVlLFxuICAgICAgc2VhbFF1YW50aXR5OiBzZWFsUXVhbnRpdHkgPz8gJzEnLFxuICAgICAganVyaXNkaWN0aW9uOiBqdXJpc2RpY3Rpb24gPz8gJ0JWSScsXG5cbiAgICAgIC8vIFJlZ2lzdGVyZWQgb2ZmaWNlIGRlcml2ZWQgZmllbGRzXG4gICAgICBuZWVkc1JlZ2lzdGVyZWRPZmZpY2UsXG4gICAgICBvZmZpY2VMb2NhdGlvbixcbiAgICAgIHJlZ2lzdGVyZWRPZmZpY2VGZWVIS0QsXG5cbiAgICAgIC8vIFNpZ25hdHVyZSAvIHZlcmlmaWNhdGlvblxuICAgICAgY29tcGxldGVkQnlOYW1lOiBjb21wbGV0ZWRCeU5hbWUgPz8gbnVsbCxcbiAgICAgIHNpZ25hdHVyZVR5cGU6IHNpZ25hdHVyZVR5cGUgPz8gbnVsbCxcbiAgICAgIHNpZ25hdHVyZUZpbGVQYXRoOiBzaWduYXR1cmVGaWxlUGF0aCA/PyBudWxsLFxuICAgICAgc2lnbmF0dXJlRmlsZU5hbWU6IHNpZ25hdHVyZUZpbGVOYW1lID8/IG51bGwsXG4gICAgICBzaWduZWRBdDogc2lnbmVkQXRTZXJ2ZXIsXG4gICAgICBpcEFkZHJlc3M6IGluZmVycmVkSXAsXG4gICAgICB1c2VyQWdlbnQ6IGluZmVycmVkVUEsXG5cbiAgICAgIHN0YXR1cyxcbiAgICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKSxcbiAgICB9XG5cbiAgICAvLyBVcHNlcnQgYnkgb25ib2FyZGluZ0lkXG4gICAgY29uc3QgZHJhZnQgPSBhd2FpdCBwcmlzbWEuY29tcGFueUluY29ycG9yYXRpb24udXBzZXJ0KHtcbiAgICAgIHdoZXJlOiB7IG9uYm9hcmRpbmdJZCB9LFxuICAgICAgY3JlYXRlOiB7IG9uYm9hcmRpbmdJZCwgLi4ucHJpc21hRGF0YSB9LFxuICAgICAgdXBkYXRlOiBwcmlzbWFEYXRhLFxuICAgICAgc2VsZWN0OiB7XG4gICAgICAgIG9uYm9hcmRpbmdJZDogdHJ1ZSxcbiAgICAgICAganVyaXNkaWN0aW9uOiB0cnVlLFxuICAgICAgICBjb21wYW55TmFtZXM6IHRydWUsXG4gICAgICAgIHNpZ25lZEF0OiB0cnVlLFxuICAgICAgfSxcbiAgICB9KVxuXG4gICAgLy8gLS0tLSBQcm9zcGVjdCArIGVtYWlsIHNpZGUtZWZmZWN0cyAobm9uLWZhdGFsKSAtLS0tXG4gICAgbGV0IGRpZFByb3NwZWN0ID0gZmFsc2VcbiAgICBsZXQgZGlkRW1haWwgPSBmYWxzZVxuXG4gICAgdHJ5IHtcbiAgICAgIC8vIFByZWZlciBib2R54oCZcyBmaXJzdFByZWYgKGxhdGVzdCksIGZhbGxiYWNrIHRvIERCIHNuYXBzaG90XG4gICAgICBjb25zdCBib2R5Rmlyc3RQcmVmID1cbiAgICAgICAgY29tcGFueU5hbWVzICYmIHR5cGVvZiBjb21wYW55TmFtZXMgPT09ICdvYmplY3QnXG4gICAgICAgICAgPyAoY29tcGFueU5hbWVzIGFzIGFueSk/LmZpcnN0UHJlZmVyZW5jZVxuICAgICAgICAgIDogdW5kZWZpbmVkXG5cbiAgICAgIGNvbnN0IGRiRmlyc3RQcmVmID1cbiAgICAgICAgZHJhZnQuY29tcGFueU5hbWVzICYmIHR5cGVvZiBkcmFmdC5jb21wYW55TmFtZXMgPT09ICdvYmplY3QnXG4gICAgICAgICAgPyAoZHJhZnQuY29tcGFueU5hbWVzIGFzIGFueSk/LmZpcnN0UHJlZmVyZW5jZVxuICAgICAgICAgIDogdW5kZWZpbmVkXG5cbiAgICAgIGNvbnN0IGZpcnN0UHJlZiA9IChib2R5Rmlyc3RQcmVmIHx8IGRiRmlyc3RQcmVmKT8udG9TdHJpbmcoKT8udHJpbSgpXG5cbiAgICAgIGNvbnNvbGUubG9nKCdbZHJhZnRdIGNvbXBhbnlOYW1lcyBpbmNvbWluZyA9JywgY29tcGFueU5hbWVzKVxuICAgICAgY29uc29sZS5sb2coJ1tkcmFmdF0gY29tcGFueU5hbWVzIHN0b3JlZCAgID0nLCBkcmFmdC5jb21wYW55TmFtZXMpXG4gICAgICBjb25zb2xlLmxvZygnW2RyYWZ0XSBleHRyYWN0ZWQgZmlyc3RQcmVmICA9JywgZmlyc3RQcmVmKVxuXG4gICAgICBpZiAoZmlyc3RQcmVmKSB7XG4gICAgICAgIC8vIDEpIFVwc2VydCBQcm9zcGVjdFxuICAgICAgICBhd2FpdCB1cHNlcnRQcm9zcGVjdCh7XG4gICAgICAgICAgdXNlcklkOiBvbmJvYXJkaW5nLnVzZXJJZCxcbiAgICAgICAgICBvbmJvYXJkaW5nSWQ6IGRyYWZ0Lm9uYm9hcmRpbmdJZCxcbiAgICAgICAgICBqdXJpc2RpY3Rpb246IGRyYWZ0Lmp1cmlzZGljdGlvbiB8fCAnQlZJJyxcbiAgICAgICAgICByYXdOYW1lOiBmaXJzdFByZWYsXG4gICAgICAgIH0pXG4gICAgICAgIGRpZFByb3NwZWN0ID0gdHJ1ZVxuICAgICAgICBjb25zb2xlLmxvZygnW2RyYWZ0XSB1cHNlcnRQcm9zcGVjdCBPSycpXG5cbiAgICAgICAgLy8gMikgRW5zdXJlIHBlbmRpbmcgb3JkZXIgKyAoc2ltdWxhdGUpIGVtYWlsXG4gICAgICAgIGNvbnN0IGFwcFVybCA9XG4gICAgICAgICAgcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfQVBQX1VSTCB8fFxuICAgICAgICAgIHByb2Nlc3MuZW52Lk5FWFRBVVRIX1VSTCB8fFxuICAgICAgICAgICdodHRwOi8vbG9jYWxob3N0OjMwMDAnXG4gICAgICAgIGNvbnN0IHByaWNpbmdVcmwgPSBgJHthcHBVcmx9L3ByaWNpbmc/b25ib2FyZGluZ0lkPSR7ZHJhZnQub25ib2FyZGluZ0lkfWBcblxuICAgICAgICBjb25zdCBlbWFpbFJlcyA9IGF3YWl0IGVuc3VyZVBlbmRpbmdPcmRlcih7XG4gICAgICAgICAgdXNlcklkOiBvbmJvYXJkaW5nLnVzZXJJZCxcbiAgICAgICAgICB1c2VyRW1haWw6IHNlc3Npb24udXNlci5lbWFpbCEsXG4gICAgICAgICAgb25ib2FyZGluZ0lkOiBkcmFmdC5vbmJvYXJkaW5nSWQsXG4gICAgICAgICAganVyaXNkaWN0aW9uOiBkcmFmdC5qdXJpc2RpY3Rpb24gfHwgJ0JWSScsXG4gICAgICAgICAgY29tcGFueU5hbWVzOiBkcmFmdC5jb21wYW55TmFtZXMgYXMgYW55LFxuICAgICAgICAgIHByaWNpbmdVcmwsXG4gICAgICAgIH0pXG5cbiAgICAgICAgZGlkRW1haWwgPSB0cnVlXG4gICAgICAgIGNvbnNvbGUubG9nKCdbZHJhZnRdIGVuc3VyZVBlbmRpbmdPcmRlciBPSycsIGVtYWlsUmVzKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2coJ1tkcmFmdF0gZmlyc3RQcmVmZXJlbmNlIG1pc3Npbmcg4oCUIFByb3NwZWN0ICYgZW1haWwgc2tpcHBlZC4nKVxuICAgICAgfVxuICAgIH0gY2F0Y2ggKHNpZGVGeEVycikge1xuICAgICAgY29uc29sZS53YXJuKCdbZHJhZnRdIHNpZGUtZWZmZWN0cyB3YXJuaW5nIChwcm9zcGVjdC9lbWFpbCk6Jywgc2lkZUZ4RXJyKVxuICAgIH1cblxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IG9rOiB0cnVlLCBkYXRhOiBkcmFmdCwgZGlkUHJvc3BlY3QsIGRpZEVtYWlsIH0pXG4gIH0gY2F0Y2ggKGVycjogYW55KSB7XG4gICAgY29uc3QgY29kZSA9IGVycj8uY29kZVxuICAgIGlmIChjb2RlID09PSAnUDIwMDMnKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdGb3JlaWduIGtleSBjb25zdHJhaW50IGZhaWxlZC4gQ2hlY2sgb25ib2FyZGluZ0lkLicgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApXG4gICAgfVxuICAgIGlmIChjb2RlID09PSAnUDIwMDInKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgZXJyb3I6ICdVbmlxdWUgY29uc3RyYWludCBmYWlsZWQuJyB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgIClcbiAgICB9XG4gICAgY29uc29sZS5lcnJvcignW1NhdmUgZHJhZnRdIFVuaGFuZGxlZCBlcnJvcjonLCBlcnIpXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdGYWlsZWQgdG8gc2F2ZSBkcmFmdCcgfSwgeyBzdGF0dXM6IDUwMCB9KVxuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgYXV0aCgpXG4gICAgaWYgKCFzZXNzaW9uPy51c2VyPy5lbWFpbCkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdVbmF1dGhvcml6ZWQnIH0sIHsgc3RhdHVzOiA0MDEgfSlcbiAgICB9XG5cbiAgICBjb25zdCB7IHNlYXJjaFBhcmFtcyB9ID0gbmV3IFVSTChyZXF1ZXN0LnVybClcbiAgICBjb25zdCBvbmJvYXJkaW5nSWQgPSBzZWFyY2hQYXJhbXMuZ2V0KCdvbmJvYXJkaW5nSWQnKVxuICAgIGlmICghb25ib2FyZGluZ0lkKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ29uYm9hcmRpbmdJZCBpcyByZXF1aXJlZCcgfSwgeyBzdGF0dXM6IDQwMCB9KVxuICAgIH1cblxuICAgIGNvbnN0IGRyYWZ0ID0gYXdhaXQgcHJpc21hLmNvbXBhbnlJbmNvcnBvcmF0aW9uLmZpbmRVbmlxdWUoe1xuICAgICAgd2hlcmU6IHsgb25ib2FyZGluZ0lkIH0sXG4gICAgfSlcblxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IG9rOiB0cnVlLCBkYXRhOiBkcmFmdCB8fCBudWxsIH0pXG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignTG9hZCBkcmFmdCBlcnJvcjonLCBlcnJvcilcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ0ZhaWxlZCB0byBsb2FkIGRyYWZ0JyB9LCB7IHN0YXR1czogNTAwIH0pXG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJhdXRoIiwicHJpc21hIiwiZW5zdXJlUGVuZGluZ09yZGVyIiwidXBzZXJ0UHJvc3BlY3QiLCJydW50aW1lIiwiZHluYW1pYyIsImFzRGF0ZU9yTnVsbCIsInYiLCJEYXRlIiwiZCIsIlN0cmluZyIsImlzTmFOIiwiZ2V0VGltZSIsImpzb25PciIsImRlZmF1bHRWYWwiLCJ2YWwiLCJ1bmRlZmluZWQiLCJqc29uT3JPYmoiLCJqc29uT3JBcnIiLCJQT1NUIiwicmVxdWVzdCIsInNlc3Npb24iLCJ1c2VyIiwiaWQiLCJlbWFpbCIsImpzb24iLCJlcnJvciIsInN0YXR1cyIsImJvZHkiLCJjYXRjaCIsIm9uYm9hcmRpbmdJZCIsImZvcm1EYXRhIiwib25ib2FyZGluZyIsImNsaWVudE9uYm9hcmRpbmciLCJmaW5kVW5pcXVlIiwid2hlcmUiLCJzZWxlY3QiLCJ1c2VySWQiLCJzaWduYXR1cmVUeXBlIiwic2lnbmF0dXJlRmlsZVBhdGgiLCJzaWduYXR1cmVGaWxlTmFtZSIsImNvbXBsZXRlZEJ5TmFtZSIsInNpZ25lZEF0IiwiaXBBZGRyZXNzIiwidXNlckFnZW50IiwianVyaXNkaWN0aW9uIiwicHVycG9zZU9mQ29tcGFueSIsImdlb2dyYXBoaWNQcm9maWxlIiwiYXV0aG9yaXplZFNoYXJlcyIsInNoYXJlc1BhclZhbHVlIiwiY3VycmVuY3kiLCJjdXN0b21TaGFyZXMiLCJjdXN0b21QYXJWYWx1ZSIsImNvbXBsZXhTdHJ1Y3R1cmVOb3RlcyIsIm9yZGVyU2VhbCIsInNlYWxRdWFudGl0eSIsInJlcXVpcmVzTm9taW5lZVNoYXJlaG9sZGVyIiwicmVxdWlyZXNOb21pbmVlRGlyZWN0b3IiLCJjb21wYW55TmFtZXMiLCJyZWxldmFudEluZGl2aWR1YWxzIiwic291cmNlT2ZGdW5kcyIsInJlY29yZHNMb2NhdGlvbiIsImRlY2xhcmF0aW9uIiwic2hhcmVob2xkZXJzIiwiZGlyZWN0b3JzIiwiX3Jlc3RJZ25vcmVkIiwiaW5mZXJyZWRJcCIsImhlYWRlcnMiLCJnZXQiLCJzcGxpdCIsInRyaW0iLCJpbmZlcnJlZFVBIiwic2lnbmVkQXRTZXJ2ZXIiLCJuZWVkc1JlZ2lzdGVyZWRPZmZpY2UiLCJCb29sZWFuIiwib2ZmaWNlTG9jYXRpb24iLCJyZWdpc3RlcmVkT2ZmaWNlRmVlSEtEIiwicHJpc21hRGF0YSIsInVwZGF0ZWRBdCIsImRyYWZ0IiwiY29tcGFueUluY29ycG9yYXRpb24iLCJ1cHNlcnQiLCJjcmVhdGUiLCJ1cGRhdGUiLCJkaWRQcm9zcGVjdCIsImRpZEVtYWlsIiwiYm9keUZpcnN0UHJlZiIsImZpcnN0UHJlZmVyZW5jZSIsImRiRmlyc3RQcmVmIiwiZmlyc3RQcmVmIiwidG9TdHJpbmciLCJjb25zb2xlIiwibG9nIiwicmF3TmFtZSIsImFwcFVybCIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19BUFBfVVJMIiwiTkVYVEFVVEhfVVJMIiwicHJpY2luZ1VybCIsImVtYWlsUmVzIiwidXNlckVtYWlsIiwic2lkZUZ4RXJyIiwid2FybiIsIm9rIiwiZGF0YSIsImVyciIsImNvZGUiLCJHRVQiLCJzZWFyY2hQYXJhbXMiLCJVUkwiLCJ1cmwiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./app/api/company-incorporation/draft/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/auth-utils.ts":
/*!***************************!*\
  !*** ./lib/auth-utils.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   registerUser: () => (/* binding */ registerUser),\n/* harmony export */   verifyUser: () => (/* binding */ verifyUser)\n/* harmony export */ });\n/* harmony import */ var _lib_prisma__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/prisma */ \"(rsc)/./lib/prisma.ts\");\n/* harmony import */ var bcryptjs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! bcryptjs */ \"(rsc)/./node_modules/bcryptjs/index.js\");\n// lib/auth-utils.ts\n\n\nasync function registerUser(name, email, password, phone) {\n    try {\n        console.log(\"Registering user:\", email);\n        // Validate input\n        if (!name || !email || !password) {\n            throw new Error(\"All fields are required\");\n        }\n        if (password.length < 6) {\n            throw new Error(\"Password must be at least 6 characters\");\n        }\n        // Check if user exists\n        const existingUser = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.user.findUnique({\n            where: {\n                email\n            }\n        });\n        if (existingUser) {\n            throw new Error(\"User with this email already exists\");\n        }\n        // Hash password\n        const hashedPassword = await bcryptjs__WEBPACK_IMPORTED_MODULE_1__[\"default\"].hash(password, 12);\n        // Create user\n        const user = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.user.create({\n            data: {\n                name,\n                email,\n                password: hashedPassword\n            }\n        });\n        console.log(\"User registered successfully:\", user.id);\n        return {\n            id: user.id,\n            name: user.name,\n            email: user.email\n        };\n    } catch (error) {\n        console.error(\"Registration error:\", error);\n        throw error;\n    }\n}\nasync function verifyUser(email, password) {\n    try {\n        console.log(\"Verifying user:\", email);\n        const user = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.user.findUnique({\n            where: {\n                email\n            }\n        });\n        if (!user || !user.password) {\n            throw new Error(\"Invalid email or password\");\n        }\n        const passwordValid = await bcryptjs__WEBPACK_IMPORTED_MODULE_1__[\"default\"].compare(password, user.password);\n        if (!passwordValid) {\n            throw new Error(\"Invalid email or password\");\n        }\n        console.log(\"User verified successfully:\", user.id);\n        return {\n            id: user.id,\n            name: user.name,\n            email: user.email\n        };\n    } catch (error) {\n        console.error(\"Verification error:\", error);\n        throw error;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvYXV0aC11dGlscy50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUEsb0JBQW9CO0FBQ2lCO0FBQ1I7QUFFdEIsZUFBZUUsYUFBYUMsSUFBWSxFQUFFQyxLQUFhLEVBQUVDLFFBQWdCLEVBQUVDLEtBQWM7SUFDOUYsSUFBSTtRQUNGQyxRQUFRQyxHQUFHLENBQUMscUJBQXFCSjtRQUVqQyxpQkFBaUI7UUFDakIsSUFBSSxDQUFDRCxRQUFRLENBQUNDLFNBQVMsQ0FBQ0MsVUFBVTtZQUNoQyxNQUFNLElBQUlJLE1BQU07UUFDbEI7UUFFQSxJQUFJSixTQUFTSyxNQUFNLEdBQUcsR0FBRztZQUN2QixNQUFNLElBQUlELE1BQU07UUFDbEI7UUFFQSx1QkFBdUI7UUFDdkIsTUFBTUUsZUFBZSxNQUFNWCwrQ0FBTUEsQ0FBQ1ksSUFBSSxDQUFDQyxVQUFVLENBQUM7WUFDaERDLE9BQU87Z0JBQUVWO1lBQU07UUFDakI7UUFFQSxJQUFJTyxjQUFjO1lBQ2hCLE1BQU0sSUFBSUYsTUFBTTtRQUNsQjtRQUVBLGdCQUFnQjtRQUNoQixNQUFNTSxpQkFBaUIsTUFBTWQscURBQVcsQ0FBQ0ksVUFBVTtRQUVuRCxjQUFjO1FBQ2QsTUFBTU8sT0FBTyxNQUFNWiwrQ0FBTUEsQ0FBQ1ksSUFBSSxDQUFDSyxNQUFNLENBQUM7WUFDcENDLE1BQU07Z0JBQ0pmO2dCQUNBQztnQkFDQUMsVUFBVVU7WUFDWjtRQUNGO1FBRUFSLFFBQVFDLEdBQUcsQ0FBQyxpQ0FBaUNJLEtBQUtPLEVBQUU7UUFDcEQsT0FBTztZQUFFQSxJQUFJUCxLQUFLTyxFQUFFO1lBQUVoQixNQUFNUyxLQUFLVCxJQUFJO1lBQUVDLE9BQU9RLEtBQUtSLEtBQUs7UUFBQTtJQUUxRCxFQUFFLE9BQU9nQixPQUFPO1FBQ2RiLFFBQVFhLEtBQUssQ0FBQyx1QkFBdUJBO1FBQ3JDLE1BQU1BO0lBQ1I7QUFDRjtBQUVPLGVBQWVDLFdBQVdqQixLQUFhLEVBQUVDLFFBQWdCO0lBQzlELElBQUk7UUFDRkUsUUFBUUMsR0FBRyxDQUFDLG1CQUFtQko7UUFFL0IsTUFBTVEsT0FBTyxNQUFNWiwrQ0FBTUEsQ0FBQ1ksSUFBSSxDQUFDQyxVQUFVLENBQUM7WUFDeENDLE9BQU87Z0JBQUVWO1lBQU07UUFDakI7UUFFQSxJQUFJLENBQUNRLFFBQVEsQ0FBQ0EsS0FBS1AsUUFBUSxFQUFFO1lBQzNCLE1BQU0sSUFBSUksTUFBTTtRQUNsQjtRQUVBLE1BQU1hLGdCQUFnQixNQUFNckIsd0RBQWMsQ0FBQ0ksVUFBVU8sS0FBS1AsUUFBUTtRQUVsRSxJQUFJLENBQUNpQixlQUFlO1lBQ2xCLE1BQU0sSUFBSWIsTUFBTTtRQUNsQjtRQUVBRixRQUFRQyxHQUFHLENBQUMsK0JBQStCSSxLQUFLTyxFQUFFO1FBQ2xELE9BQU87WUFBRUEsSUFBSVAsS0FBS08sRUFBRTtZQUFFaEIsTUFBTVMsS0FBS1QsSUFBSTtZQUFFQyxPQUFPUSxLQUFLUixLQUFLO1FBQUM7SUFFM0QsRUFBRSxPQUFPZ0IsT0FBTztRQUNkYixRQUFRYSxLQUFLLENBQUMsdUJBQXVCQTtRQUNyQyxNQUFNQTtJQUNSO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9teS12MC1wcm9qZWN0Ly4vbGliL2F1dGgtdXRpbHMudHM/MzgxMyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBsaWIvYXV0aC11dGlscy50c1xuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSAnQC9saWIvcHJpc21hJ1xuaW1wb3J0IGJjcnlwdCBmcm9tICdiY3J5cHRqcydcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJlZ2lzdGVyVXNlcihuYW1lOiBzdHJpbmcsIGVtYWlsOiBzdHJpbmcsIHBhc3N3b3JkOiBzdHJpbmcsIHBob25lPzogc3RyaW5nKSB7XG4gIHRyeSB7XG4gICAgY29uc29sZS5sb2coJ1JlZ2lzdGVyaW5nIHVzZXI6JywgZW1haWwpO1xuICAgIFxuICAgIC8vIFZhbGlkYXRlIGlucHV0XG4gICAgaWYgKCFuYW1lIHx8ICFlbWFpbCB8fCAhcGFzc3dvcmQpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignQWxsIGZpZWxkcyBhcmUgcmVxdWlyZWQnKVxuICAgIH1cblxuICAgIGlmIChwYXNzd29yZC5sZW5ndGggPCA2KSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1Bhc3N3b3JkIG11c3QgYmUgYXQgbGVhc3QgNiBjaGFyYWN0ZXJzJylcbiAgICB9XG5cbiAgICAvLyBDaGVjayBpZiB1c2VyIGV4aXN0c1xuICAgIGNvbnN0IGV4aXN0aW5nVXNlciA9IGF3YWl0IHByaXNtYS51c2VyLmZpbmRVbmlxdWUoe1xuICAgICAgd2hlcmU6IHsgZW1haWwgfVxuICAgIH0pXG5cbiAgICBpZiAoZXhpc3RpbmdVc2VyKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ1VzZXIgd2l0aCB0aGlzIGVtYWlsIGFscmVhZHkgZXhpc3RzJylcbiAgICB9XG5cbiAgICAvLyBIYXNoIHBhc3N3b3JkXG4gICAgY29uc3QgaGFzaGVkUGFzc3dvcmQgPSBhd2FpdCBiY3J5cHQuaGFzaChwYXNzd29yZCwgMTIpXG5cbiAgICAvLyBDcmVhdGUgdXNlclxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBwcmlzbWEudXNlci5jcmVhdGUoe1xuICAgICAgZGF0YToge1xuICAgICAgICBuYW1lLFxuICAgICAgICBlbWFpbCxcbiAgICAgICAgcGFzc3dvcmQ6IGhhc2hlZFBhc3N3b3JkLFxuICAgICAgfVxuICAgIH0pXG5cbiAgICBjb25zb2xlLmxvZygnVXNlciByZWdpc3RlcmVkIHN1Y2Nlc3NmdWxseTonLCB1c2VyLmlkKTtcbiAgICByZXR1cm4geyBpZDogdXNlci5pZCwgbmFtZTogdXNlci5uYW1lLCBlbWFpbDogdXNlci5lbWFpbH1cbiAgICBcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdSZWdpc3RyYXRpb24gZXJyb3I6JywgZXJyb3IpO1xuICAgIHRocm93IGVycm9yO1xuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiB2ZXJpZnlVc2VyKGVtYWlsOiBzdHJpbmcsIHBhc3N3b3JkOiBzdHJpbmcpIHtcbiAgdHJ5IHtcbiAgICBjb25zb2xlLmxvZygnVmVyaWZ5aW5nIHVzZXI6JywgZW1haWwpO1xuICAgIFxuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBwcmlzbWEudXNlci5maW5kVW5pcXVlKHtcbiAgICAgIHdoZXJlOiB7IGVtYWlsIH1cbiAgICB9KVxuXG4gICAgaWYgKCF1c2VyIHx8ICF1c2VyLnBhc3N3b3JkKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgZW1haWwgb3IgcGFzc3dvcmQnKVxuICAgIH1cblxuICAgIGNvbnN0IHBhc3N3b3JkVmFsaWQgPSBhd2FpdCBiY3J5cHQuY29tcGFyZShwYXNzd29yZCwgdXNlci5wYXNzd29yZClcblxuICAgIGlmICghcGFzc3dvcmRWYWxpZCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIGVtYWlsIG9yIHBhc3N3b3JkJylcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZygnVXNlciB2ZXJpZmllZCBzdWNjZXNzZnVsbHk6JywgdXNlci5pZCk7XG4gICAgcmV0dXJuIHsgaWQ6IHVzZXIuaWQsIG5hbWU6IHVzZXIubmFtZSwgZW1haWw6IHVzZXIuZW1haWwgfVxuICAgIFxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1ZlcmlmaWNhdGlvbiBlcnJvcjonLCBlcnJvcik7XG4gICAgdGhyb3cgZXJyb3I7XG4gIH1cbn0iXSwibmFtZXMiOlsicHJpc21hIiwiYmNyeXB0IiwicmVnaXN0ZXJVc2VyIiwibmFtZSIsImVtYWlsIiwicGFzc3dvcmQiLCJwaG9uZSIsImNvbnNvbGUiLCJsb2ciLCJFcnJvciIsImxlbmd0aCIsImV4aXN0aW5nVXNlciIsInVzZXIiLCJmaW5kVW5pcXVlIiwid2hlcmUiLCJoYXNoZWRQYXNzd29yZCIsImhhc2giLCJjcmVhdGUiLCJkYXRhIiwiaWQiLCJlcnJvciIsInZlcmlmeVVzZXIiLCJwYXNzd29yZFZhbGlkIiwiY29tcGFyZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/auth-utils.ts\n");

/***/ }),

/***/ "(rsc)/./lib/auth.ts":
/*!*********************!*\
  !*** ./lib/auth.ts ***!
  \*********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   auth: () => (/* binding */ auth),\n/* harmony export */   handlers: () => (/* binding */ handlers),\n/* harmony export */   signIn: () => (/* binding */ signIn),\n/* harmony export */   signOut: () => (/* binding */ signOut)\n/* harmony export */ });\n/* harmony import */ var next_auth__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next-auth */ \"(rsc)/./node_modules/next-auth/index.js\");\n/* harmony import */ var next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next-auth/providers/credentials */ \"(rsc)/./node_modules/next-auth/providers/credentials.js\");\n/* harmony import */ var _lib_auth_utils__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/auth-utils */ \"(rsc)/./lib/auth-utils.ts\");\n// lib/auth.ts\n\n\n\nconst { handlers, auth, signIn, signOut } = (0,next_auth__WEBPACK_IMPORTED_MODULE_0__[\"default\"])({\n    providers: [\n        (0,next_auth_providers_credentials__WEBPACK_IMPORTED_MODULE_1__[\"default\"])({\n            name: \"credentials\",\n            credentials: {\n                email: {\n                    label: \"Email\",\n                    type: \"email\"\n                },\n                password: {\n                    label: \"Password\",\n                    type: \"password\"\n                }\n            },\n            async authorize (credentials) {\n                try {\n                    if (!credentials?.email || !credentials?.password) {\n                        return null;\n                    }\n                    const user = await (0,_lib_auth_utils__WEBPACK_IMPORTED_MODULE_2__.verifyUser)(credentials.email, credentials.password);\n                    return user;\n                } catch (error) {\n                    console.error(\"Auth error:\", error);\n                    return null;\n                }\n            }\n        })\n    ],\n    session: {\n        strategy: \"jwt\"\n    },\n    pages: {\n        signIn: \"/login\"\n    },\n    callbacks: {\n        async jwt ({ token, user }) {\n            if (user) {\n                token.id = user.id;\n                token.email = user.email;\n            }\n            return token;\n        },\n        async session ({ session, token }) {\n            if (token && session.user) {\n                session.user.id = token.id;\n                session.user.email = token.email;\n            }\n            return session;\n        }\n    }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvYXV0aC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQUEsY0FBYztBQUNrQjtBQUN5QjtBQUNaO0FBRXRDLE1BQU0sRUFBRUcsUUFBUSxFQUFFQyxJQUFJLEVBQUVDLE1BQU0sRUFBRUMsT0FBTyxFQUFFLEdBQUdOLHFEQUFRQSxDQUFDO0lBQzFETyxXQUFXO1FBQ1ROLDJFQUFXQSxDQUFDO1lBQ1ZPLE1BQU07WUFDTkMsYUFBYTtnQkFDWEMsT0FBTztvQkFBRUMsT0FBTztvQkFBU0MsTUFBTTtnQkFBUTtnQkFDdkNDLFVBQVU7b0JBQUVGLE9BQU87b0JBQVlDLE1BQU07Z0JBQVc7WUFDbEQ7WUFDQSxNQUFNRSxXQUFVTCxXQUFXO2dCQUN6QixJQUFJO29CQUNGLElBQUksQ0FBQ0EsYUFBYUMsU0FBUyxDQUFDRCxhQUFhSSxVQUFVO3dCQUNqRCxPQUFPO29CQUNUO29CQUVBLE1BQU1FLE9BQU8sTUFBTWIsMkRBQVVBLENBQzNCTyxZQUFZQyxLQUFLLEVBQ2pCRCxZQUFZSSxRQUFRO29CQUd0QixPQUFPRTtnQkFDVCxFQUFFLE9BQU9DLE9BQU87b0JBQ2RDLFFBQVFELEtBQUssQ0FBQyxlQUFlQTtvQkFDN0IsT0FBTztnQkFDVDtZQUNGO1FBQ0Y7S0FDRDtJQUNERSxTQUFTO1FBQ1BDLFVBQVU7SUFDWjtJQUNBQyxPQUFPO1FBQ0xmLFFBQVE7SUFDVjtJQUNBZ0IsV0FBVztRQUNULE1BQU1DLEtBQUksRUFBRUMsS0FBSyxFQUFFUixJQUFJLEVBQUU7WUFDdkIsSUFBSUEsTUFBTTtnQkFDUlEsTUFBTUMsRUFBRSxHQUFHVCxLQUFLUyxFQUFFO2dCQUNsQkQsTUFBTWIsS0FBSyxHQUFHSyxLQUFLTCxLQUFLO1lBQzFCO1lBQ0EsT0FBT2E7UUFDVDtRQUNBLE1BQU1MLFNBQVEsRUFBRUEsT0FBTyxFQUFFSyxLQUFLLEVBQUU7WUFDOUIsSUFBSUEsU0FBU0wsUUFBUUgsSUFBSSxFQUFFO2dCQUN6QkcsUUFBUUgsSUFBSSxDQUFDUyxFQUFFLEdBQUdELE1BQU1DLEVBQUU7Z0JBQzFCTixRQUFRSCxJQUFJLENBQUNMLEtBQUssR0FBR2EsTUFBTWIsS0FBSztZQUNsQztZQUNBLE9BQU9RO1FBQ1Q7SUFDRjtBQUNGLEdBQUUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9teS12MC1wcm9qZWN0Ly4vbGliL2F1dGgudHM/YmY3ZSJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBsaWIvYXV0aC50c1xuaW1wb3J0IE5leHRBdXRoIGZyb20gJ25leHQtYXV0aCdcbmltcG9ydCBDcmVkZW50aWFscyBmcm9tICduZXh0LWF1dGgvcHJvdmlkZXJzL2NyZWRlbnRpYWxzJ1xuaW1wb3J0IHsgdmVyaWZ5VXNlciB9IGZyb20gJ0AvbGliL2F1dGgtdXRpbHMnXG5cbmV4cG9ydCBjb25zdCB7IGhhbmRsZXJzLCBhdXRoLCBzaWduSW4sIHNpZ25PdXQgfSA9IE5leHRBdXRoKHtcbiAgcHJvdmlkZXJzOiBbXG4gICAgQ3JlZGVudGlhbHMoe1xuICAgICAgbmFtZTogJ2NyZWRlbnRpYWxzJyxcbiAgICAgIGNyZWRlbnRpYWxzOiB7XG4gICAgICAgIGVtYWlsOiB7IGxhYmVsOiAnRW1haWwnLCB0eXBlOiAnZW1haWwnIH0sXG4gICAgICAgIHBhc3N3b3JkOiB7IGxhYmVsOiAnUGFzc3dvcmQnLCB0eXBlOiAncGFzc3dvcmQnIH1cbiAgICAgIH0sXG4gICAgICBhc3luYyBhdXRob3JpemUoY3JlZGVudGlhbHMpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBpZiAoIWNyZWRlbnRpYWxzPy5lbWFpbCB8fCAhY3JlZGVudGlhbHM/LnBhc3N3b3JkKSB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbFxuICAgICAgICAgIH1cblxuICAgICAgICAgIGNvbnN0IHVzZXIgPSBhd2FpdCB2ZXJpZnlVc2VyKFxuICAgICAgICAgICAgY3JlZGVudGlhbHMuZW1haWwgYXMgc3RyaW5nLFxuICAgICAgICAgICAgY3JlZGVudGlhbHMucGFzc3dvcmQgYXMgc3RyaW5nXG4gICAgICAgICAgKVxuXG4gICAgICAgICAgcmV0dXJuIHVzZXJcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKCdBdXRoIGVycm9yOicsIGVycm9yKVxuICAgICAgICAgIHJldHVybiBudWxsXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9KVxuICBdLFxuICBzZXNzaW9uOiB7XG4gICAgc3RyYXRlZ3k6ICdqd3QnLFxuICB9LFxuICBwYWdlczoge1xuICAgIHNpZ25JbjogJy9sb2dpbicsXG4gIH0sXG4gIGNhbGxiYWNrczoge1xuICAgIGFzeW5jIGp3dCh7IHRva2VuLCB1c2VyIH0pIHtcbiAgICAgIGlmICh1c2VyKSB7XG4gICAgICAgIHRva2VuLmlkID0gdXNlci5pZFxuICAgICAgICB0b2tlbi5lbWFpbCA9IHVzZXIuZW1haWxcbiAgICAgIH1cbiAgICAgIHJldHVybiB0b2tlblxuICAgIH0sXG4gICAgYXN5bmMgc2Vzc2lvbih7IHNlc3Npb24sIHRva2VuIH0pIHtcbiAgICAgIGlmICh0b2tlbiAmJiBzZXNzaW9uLnVzZXIpIHtcbiAgICAgICAgc2Vzc2lvbi51c2VyLmlkID0gdG9rZW4uaWQgYXMgc3RyaW5nXG4gICAgICAgIHNlc3Npb24udXNlci5lbWFpbCA9IHRva2VuLmVtYWlsIGFzIHN0cmluZ1xuICAgICAgfVxuICAgICAgcmV0dXJuIHNlc3Npb25cbiAgICB9LFxuICB9LFxufSkiXSwibmFtZXMiOlsiTmV4dEF1dGgiLCJDcmVkZW50aWFscyIsInZlcmlmeVVzZXIiLCJoYW5kbGVycyIsImF1dGgiLCJzaWduSW4iLCJzaWduT3V0IiwicHJvdmlkZXJzIiwibmFtZSIsImNyZWRlbnRpYWxzIiwiZW1haWwiLCJsYWJlbCIsInR5cGUiLCJwYXNzd29yZCIsImF1dGhvcml6ZSIsInVzZXIiLCJlcnJvciIsImNvbnNvbGUiLCJzZXNzaW9uIiwic3RyYXRlZ3kiLCJwYWdlcyIsImNhbGxiYWNrcyIsImp3dCIsInRva2VuIiwiaWQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/auth.ts\n");

/***/ }),

/***/ "(rsc)/./lib/mailer.ts":
/*!***********************!*\
  !*** ./lib/mailer.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   sendEmail: () => (/* binding */ sendEmail)\n/* harmony export */ });\n/* harmony import */ var resend__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! resend */ \"(rsc)/./node_modules/resend/dist/index.mjs\");\n// lib/mailer.ts\n\n/**\n * Email sending with safe console fallback.\n * - Uses EMAIL_FROM if set (keeps consistent with other modules), then RESEND_FROM, then a default\n * - If RESEND_API_KEY missing or sending fails, logs a full email preview to console and returns success\n */ const RESEND_API_KEY = process.env.RESEND_API_KEY || \"\";\nconst EMAIL_FROM = process.env.EMAIL_FROM || process.env.RESEND_FROM || \"no-reply@example.test\";\nconst IS_SIMULATE = !RESEND_API_KEY;\nlet resend = null;\nif (RESEND_API_KEY) {\n    resend = new resend__WEBPACK_IMPORTED_MODULE_0__.Resend(RESEND_API_KEY);\n}\nfunction logEmailPreview(tag, payload) {\n    // Single place for console previews\n    console.log(`--- EMAIL (${tag}) ---`);\n    console.log(\"From:\", payload.from || EMAIL_FROM);\n    console.log(\"To:\", Array.isArray(payload.to) ? payload.to.join(\", \") : payload.to);\n    console.log(\"Subject:\", payload.subject);\n    if (payload.text) console.log(\"Text:\", payload.text);\n    if (payload.html) console.log(\"HTML:\", payload.html);\n    console.log(\"----------------------\");\n}\nasync function sendEmail({ to, subject, text, html, from }) {\n    const payload = {\n        to,\n        subject,\n        text,\n        html,\n        from\n    };\n    // Guard: basic validation for \"to\"\n    if (!to || Array.isArray(to) && to.length === 0) {\n        console.warn('[sendEmail] Missing recipient \"to\" — skipping send.');\n        return {\n            id: \"skipped-no-recipient\",\n            success: false\n        };\n    }\n    // Simulate if no API key\n    if (IS_SIMULATE || !resend) {\n        logEmailPreview(\"console-fallback\", payload);\n        return {\n            id: \"console-fallback\",\n            success: true\n        };\n    }\n    try {\n        const { data, error } = await resend.emails.send({\n            from: from || EMAIL_FROM,\n            to,\n            subject,\n            text,\n            html\n        });\n        if (error) throw error;\n        return {\n            id: data?.id || \"resend\",\n            success: true\n        };\n    } catch (err) {\n        // Don’t crash the app on email failure; print full preview and proceed\n        console.warn(\"[sendEmail] Resend failed, falling back to console preview:\", err);\n        logEmailPreview(\"fallback-on-error\", payload);\n        return {\n            id: \"fallback-on-error\",\n            success: true\n        };\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvbWFpbGVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQUEsZ0JBQWdCO0FBQ2U7QUFFL0I7Ozs7Q0FJQyxHQUVELE1BQU1DLGlCQUFpQkMsUUFBUUMsR0FBRyxDQUFDRixjQUFjLElBQUk7QUFDckQsTUFBTUcsYUFBYUYsUUFBUUMsR0FBRyxDQUFDQyxVQUFVLElBQUlGLFFBQVFDLEdBQUcsQ0FBQ0UsV0FBVyxJQUFJO0FBQ3hFLE1BQU1DLGNBQWMsQ0FBQ0w7QUFFckIsSUFBSU0sU0FBd0I7QUFDNUIsSUFBSU4sZ0JBQWdCO0lBQ2xCTSxTQUFTLElBQUlQLDBDQUFNQSxDQUFDQztBQUN0QjtBQVdBLFNBQVNPLGdCQUFnQkMsR0FBVyxFQUFFQyxPQUEyRTtJQUMvRyxvQ0FBb0M7SUFDcENDLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLFdBQVcsRUFBRUgsSUFBSSxLQUFLLENBQUM7SUFDcENFLFFBQVFDLEdBQUcsQ0FBQyxTQUFTRixRQUFRRyxJQUFJLElBQUlUO0lBQ3JDTyxRQUFRQyxHQUFHLENBQUMsT0FBT0UsTUFBTUMsT0FBTyxDQUFDTCxRQUFRTSxFQUFFLElBQUlOLFFBQVFNLEVBQUUsQ0FBQ0MsSUFBSSxDQUFDLFFBQVFQLFFBQVFNLEVBQUU7SUFDakZMLFFBQVFDLEdBQUcsQ0FBQyxZQUFZRixRQUFRUSxPQUFPO0lBQ3ZDLElBQUlSLFFBQVFTLElBQUksRUFBRVIsUUFBUUMsR0FBRyxDQUFDLFNBQVNGLFFBQVFTLElBQUk7SUFDbkQsSUFBSVQsUUFBUVUsSUFBSSxFQUFFVCxRQUFRQyxHQUFHLENBQUMsU0FBU0YsUUFBUVUsSUFBSTtJQUNuRFQsUUFBUUMsR0FBRyxDQUFDO0FBQ2Q7QUFFTyxlQUFlUyxVQUFVLEVBQUVMLEVBQUUsRUFBRUUsT0FBTyxFQUFFQyxJQUFJLEVBQUVDLElBQUksRUFBRVAsSUFBSSxFQUFjO0lBQzNFLE1BQU1ILFVBQVU7UUFBRU07UUFBSUU7UUFBU0M7UUFBTUM7UUFBTVA7SUFBSztJQUVoRCxtQ0FBbUM7SUFDbkMsSUFBSSxDQUFDRyxNQUFPRixNQUFNQyxPQUFPLENBQUNDLE9BQU9BLEdBQUdNLE1BQU0sS0FBSyxHQUFJO1FBQ2pEWCxRQUFRWSxJQUFJLENBQUM7UUFDYixPQUFPO1lBQUVDLElBQUk7WUFBd0JDLFNBQVM7UUFBTTtJQUN0RDtJQUVBLHlCQUF5QjtJQUN6QixJQUFJbkIsZUFBZSxDQUFDQyxRQUFRO1FBQzFCQyxnQkFBZ0Isb0JBQW9CRTtRQUNwQyxPQUFPO1lBQUVjLElBQUk7WUFBb0JDLFNBQVM7UUFBSztJQUNqRDtJQUVBLElBQUk7UUFDRixNQUFNLEVBQUVDLElBQUksRUFBRUMsS0FBSyxFQUFFLEdBQUcsTUFBTXBCLE9BQU9xQixNQUFNLENBQUNDLElBQUksQ0FBQztZQUMvQ2hCLE1BQU1BLFFBQVFUO1lBQ2RZO1lBQ0FFO1lBQ0FDO1lBQ0FDO1FBQ0Y7UUFDQSxJQUFJTyxPQUFPLE1BQU1BO1FBQ2pCLE9BQU87WUFBRUgsSUFBSUUsTUFBTUYsTUFBTTtZQUFVQyxTQUFTO1FBQUs7SUFDbkQsRUFBRSxPQUFPSyxLQUFLO1FBQ1osdUVBQXVFO1FBQ3ZFbkIsUUFBUVksSUFBSSxDQUFDLCtEQUErRE87UUFDNUV0QixnQkFBZ0IscUJBQXFCRTtRQUNyQyxPQUFPO1lBQUVjLElBQUk7WUFBcUJDLFNBQVM7UUFBSztJQUNsRDtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbXktdjAtcHJvamVjdC8uL2xpYi9tYWlsZXIudHM/NzJjOCJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBsaWIvbWFpbGVyLnRzXG5pbXBvcnQgeyBSZXNlbmQgfSBmcm9tICdyZXNlbmQnXG5cbi8qKlxuICogRW1haWwgc2VuZGluZyB3aXRoIHNhZmUgY29uc29sZSBmYWxsYmFjay5cbiAqIC0gVXNlcyBFTUFJTF9GUk9NIGlmIHNldCAoa2VlcHMgY29uc2lzdGVudCB3aXRoIG90aGVyIG1vZHVsZXMpLCB0aGVuIFJFU0VORF9GUk9NLCB0aGVuIGEgZGVmYXVsdFxuICogLSBJZiBSRVNFTkRfQVBJX0tFWSBtaXNzaW5nIG9yIHNlbmRpbmcgZmFpbHMsIGxvZ3MgYSBmdWxsIGVtYWlsIHByZXZpZXcgdG8gY29uc29sZSBhbmQgcmV0dXJucyBzdWNjZXNzXG4gKi9cblxuY29uc3QgUkVTRU5EX0FQSV9LRVkgPSBwcm9jZXNzLmVudi5SRVNFTkRfQVBJX0tFWSB8fCAnJ1xuY29uc3QgRU1BSUxfRlJPTSA9IHByb2Nlc3MuZW52LkVNQUlMX0ZST00gfHwgcHJvY2Vzcy5lbnYuUkVTRU5EX0ZST00gfHwgJ25vLXJlcGx5QGV4YW1wbGUudGVzdCdcbmNvbnN0IElTX1NJTVVMQVRFID0gIVJFU0VORF9BUElfS0VZXG5cbmxldCByZXNlbmQ6IFJlc2VuZCB8IG51bGwgPSBudWxsXG5pZiAoUkVTRU5EX0FQSV9LRVkpIHtcbiAgcmVzZW5kID0gbmV3IFJlc2VuZChSRVNFTkRfQVBJX0tFWSlcbn1cblxudHlwZSBFbWFpbElucHV0ID0ge1xuICB0bzogc3RyaW5nIHwgc3RyaW5nW11cbiAgc3ViamVjdDogc3RyaW5nXG4gIHRleHQ/OiBzdHJpbmdcbiAgaHRtbD86IHN0cmluZ1xuICBmcm9tPzogc3RyaW5nXG4gIC8vIHlvdSBjYW4gZXh0ZW5kIGxhdGVyIHdpdGggY2MvYmNjL3JlcGx5VG8gaWYgbmVlZGVkXG59XG5cbmZ1bmN0aW9uIGxvZ0VtYWlsUHJldmlldyh0YWc6IHN0cmluZywgcGF5bG9hZDogUmVxdWlyZWQ8UGljazxFbWFpbElucHV0LCAndG8nIHwgJ3N1YmplY3QnPj4gJiBQYXJ0aWFsPEVtYWlsSW5wdXQ+KSB7XG4gIC8vIFNpbmdsZSBwbGFjZSBmb3IgY29uc29sZSBwcmV2aWV3c1xuICBjb25zb2xlLmxvZyhgLS0tIEVNQUlMICgke3RhZ30pIC0tLWApXG4gIGNvbnNvbGUubG9nKCdGcm9tOicsIHBheWxvYWQuZnJvbSB8fCBFTUFJTF9GUk9NKVxuICBjb25zb2xlLmxvZygnVG86JywgQXJyYXkuaXNBcnJheShwYXlsb2FkLnRvKSA/IHBheWxvYWQudG8uam9pbignLCAnKSA6IHBheWxvYWQudG8pXG4gIGNvbnNvbGUubG9nKCdTdWJqZWN0OicsIHBheWxvYWQuc3ViamVjdClcbiAgaWYgKHBheWxvYWQudGV4dCkgY29uc29sZS5sb2coJ1RleHQ6JywgcGF5bG9hZC50ZXh0KVxuICBpZiAocGF5bG9hZC5odG1sKSBjb25zb2xlLmxvZygnSFRNTDonLCBwYXlsb2FkLmh0bWwpXG4gIGNvbnNvbGUubG9nKCctLS0tLS0tLS0tLS0tLS0tLS0tLS0tJylcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNlbmRFbWFpbCh7IHRvLCBzdWJqZWN0LCB0ZXh0LCBodG1sLCBmcm9tIH06IEVtYWlsSW5wdXQpIHtcbiAgY29uc3QgcGF5bG9hZCA9IHsgdG8sIHN1YmplY3QsIHRleHQsIGh0bWwsIGZyb20gfVxuXG4gIC8vIEd1YXJkOiBiYXNpYyB2YWxpZGF0aW9uIGZvciBcInRvXCJcbiAgaWYgKCF0byB8fCAoQXJyYXkuaXNBcnJheSh0bykgJiYgdG8ubGVuZ3RoID09PSAwKSkge1xuICAgIGNvbnNvbGUud2FybignW3NlbmRFbWFpbF0gTWlzc2luZyByZWNpcGllbnQgXCJ0b1wiIOKAlCBza2lwcGluZyBzZW5kLicpXG4gICAgcmV0dXJuIHsgaWQ6ICdza2lwcGVkLW5vLXJlY2lwaWVudCcsIHN1Y2Nlc3M6IGZhbHNlIH1cbiAgfVxuXG4gIC8vIFNpbXVsYXRlIGlmIG5vIEFQSSBrZXlcbiAgaWYgKElTX1NJTVVMQVRFIHx8ICFyZXNlbmQpIHtcbiAgICBsb2dFbWFpbFByZXZpZXcoJ2NvbnNvbGUtZmFsbGJhY2snLCBwYXlsb2FkKVxuICAgIHJldHVybiB7IGlkOiAnY29uc29sZS1mYWxsYmFjaycsIHN1Y2Nlc3M6IHRydWUgfVxuICB9XG5cbiAgdHJ5IHtcbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCByZXNlbmQuZW1haWxzLnNlbmQoe1xuICAgICAgZnJvbTogZnJvbSB8fCBFTUFJTF9GUk9NLFxuICAgICAgdG8sXG4gICAgICBzdWJqZWN0LFxuICAgICAgdGV4dCxcbiAgICAgIGh0bWwsXG4gICAgfSlcbiAgICBpZiAoZXJyb3IpIHRocm93IGVycm9yXG4gICAgcmV0dXJuIHsgaWQ6IGRhdGE/LmlkIHx8ICdyZXNlbmQnLCBzdWNjZXNzOiB0cnVlIH1cbiAgfSBjYXRjaCAoZXJyKSB7XG4gICAgLy8gRG9u4oCZdCBjcmFzaCB0aGUgYXBwIG9uIGVtYWlsIGZhaWx1cmU7IHByaW50IGZ1bGwgcHJldmlldyBhbmQgcHJvY2VlZFxuICAgIGNvbnNvbGUud2FybignW3NlbmRFbWFpbF0gUmVzZW5kIGZhaWxlZCwgZmFsbGluZyBiYWNrIHRvIGNvbnNvbGUgcHJldmlldzonLCBlcnIpXG4gICAgbG9nRW1haWxQcmV2aWV3KCdmYWxsYmFjay1vbi1lcnJvcicsIHBheWxvYWQpXG4gICAgcmV0dXJuIHsgaWQ6ICdmYWxsYmFjay1vbi1lcnJvcicsIHN1Y2Nlc3M6IHRydWUgfVxuICB9XG59XG4iXSwibmFtZXMiOlsiUmVzZW5kIiwiUkVTRU5EX0FQSV9LRVkiLCJwcm9jZXNzIiwiZW52IiwiRU1BSUxfRlJPTSIsIlJFU0VORF9GUk9NIiwiSVNfU0lNVUxBVEUiLCJyZXNlbmQiLCJsb2dFbWFpbFByZXZpZXciLCJ0YWciLCJwYXlsb2FkIiwiY29uc29sZSIsImxvZyIsImZyb20iLCJBcnJheSIsImlzQXJyYXkiLCJ0byIsImpvaW4iLCJzdWJqZWN0IiwidGV4dCIsImh0bWwiLCJzZW5kRW1haWwiLCJsZW5ndGgiLCJ3YXJuIiwiaWQiLCJzdWNjZXNzIiwiZGF0YSIsImVycm9yIiwiZW1haWxzIiwic2VuZCIsImVyciJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/mailer.ts\n");

/***/ }),

/***/ "(rsc)/./lib/orders.ts":
/*!***********************!*\
  !*** ./lib/orders.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ensurePendingOrder: () => (/* binding */ ensurePendingOrder),\n/* harmony export */   generateOrderCode: () => (/* binding */ generateOrderCode),\n/* harmony export */   markOrderPaidByOnboarding: () => (/* binding */ markOrderPaidByOnboarding)\n/* harmony export */ });\n/* harmony import */ var _lib_prisma__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/prisma */ \"(rsc)/./lib/prisma.ts\");\n/* harmony import */ var _lib_mailer__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/mailer */ \"(rsc)/./lib/mailer.ts\");\n// lib/orders.ts\n\n // single mail path with console fallback\n/** Build a readable order code, e.g. SCG-BVI-20251021-0007 (date + daily sequence) */ async function generateOrderCode(jurisdiction) {\n    const j = (jurisdiction || \"BVI\").toUpperCase();\n    const today = new Date();\n    const y = today.getFullYear();\n    const m = String(today.getMonth() + 1).padStart(2, \"0\");\n    const d = String(today.getDate()).padStart(2, \"0\");\n    // Count today's orders to create a sequence number\n    const start = new Date(Date.UTC(y, today.getMonth(), today.getDate(), 0, 0, 0));\n    const end = new Date(Date.UTC(y, today.getMonth(), today.getDate() + 1, 0, 0, 0));\n    const countToday = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.order.count({\n        where: {\n            createdAt: {\n                gte: start,\n                lt: end\n            }\n        }\n    });\n    const seq = String(countToday + 1).padStart(4, \"0\");\n    return `SCG-${j}-${y}${m}${d}-${seq}`;\n}\n/**\n * Ensure there is one pending order for this onboarding.\n * If none exists, create one and send (or simulate) the email.\n * This function must NOT throw if email fails.\n */ async function ensurePendingOrder(opts) {\n    const { userId, userEmail, onboardingId, jurisdiction, companyNames, pricingUrl } = opts;\n    // 1) Find existing pending order\n    let order = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.order.findFirst({\n        where: {\n            onboardingId,\n            status: \"pending_payment\"\n        }\n    });\n    // 2) Create if not found\n    if (!order) {\n        order = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.order.create({\n            data: {\n                userId,\n                onboardingId,\n                jurisdiction: jurisdiction || \"BVI\",\n                orderCode: await generateOrderCode(jurisdiction),\n                status: \"pending_payment\"\n            }\n        });\n    }\n    // 3) Email (console fallback is inside sendEmail)\n    const preferred = companyNames?.firstPreference ? `${companyNames.firstPreference}${companyNames?.chosenEnding ? \" \" + companyNames.chosenEnding : \"\"}` : \"your company\";\n    const subject = `SCG — Complete your order ${order.orderCode}`;\n    const html = `\n    <div style=\"font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; line-height:1.6\">\n      <h2>Complete your order</h2>\n      <p>Order Code: <strong>${order.orderCode}</strong></p>\n      <p>Jurisdiction: <strong>${(jurisdiction || \"BVI\").toUpperCase()}</strong></p>\n      <p>Company name (first preference): <strong>${preferred}</strong></p>\n      <p>Please complete your payment to proceed:</p>\n      <p><a href=\"${pricingUrl}\" target=\"_blank\" rel=\"noopener\">Go to payment</a></p>\n      <hr/>\n      <p>If you already paid, you can ignore this email.</p>\n    </div>\n  `;\n    try {\n        await (0,_lib_mailer__WEBPACK_IMPORTED_MODULE_1__.sendEmail)({\n            to: userEmail,\n            from: process.env.EMAIL_FROM,\n            subject,\n            html\n        });\n    } catch (e) {\n        // Never block order creation on email failure\n        console.warn(\"[ensurePendingOrder] email send failed, continuing:\", e);\n    }\n    // 4) Record lastEmailAt (even if sendEmail only printed to console)\n    await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.order.update({\n        where: {\n            id: order.id\n        },\n        data: {\n            lastEmailAt: new Date()\n        }\n    });\n    return order;\n}\n/** Mark as paid by onboardingId (used by /pricing page) */ async function markOrderPaidByOnboarding(onboardingId) {\n    const order = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.order.findFirst({\n        where: {\n            onboardingId,\n            status: \"pending_payment\"\n        }\n    });\n    if (!order) return null;\n    const updated = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.order.update({\n        where: {\n            id: order.id\n        },\n        data: {\n            status: \"paid\"\n        }\n    });\n    return updated;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFDb0IsS0FBSyxDQUFDZ0MsTUFBTSxDQUFDO1FBQ3hCOUIsT0FBTztZQUFFK0IsSUFBSWpDLE1BQU1pQyxFQUFFO1FBQUM7UUFDdEJoQixNQUFNO1lBQUVpQixhQUFhLElBQUkvQztRQUFPO0lBQ2xDO0lBRUEsT0FBT2E7QUFDVDtBQUVBLHlEQUF5RCxHQUNsRCxlQUFlbUMsMEJBQTBCeEIsWUFBb0I7SUFDbEUsTUFBTVgsUUFBUSxNQUFNcEIsK0NBQU1BLENBQUNvQixLQUFLLENBQUNjLFNBQVMsQ0FBQztRQUN6Q1osT0FBTztZQUFFUztZQUFjSSxRQUFRO1FBQWtCO0lBQ25EO0lBQ0EsSUFBSSxDQUFDZixPQUFPLE9BQU87SUFFbkIsTUFBTW9DLFVBQVUsTUFBTXhELCtDQUFNQSxDQUFDb0IsS0FBSyxDQUFDZ0MsTUFBTSxDQUFDO1FBQ3hDOUIsT0FBTztZQUFFK0IsSUFBSWpDLE1BQU1pQyxFQUFFO1FBQUM7UUFDdEJoQixNQUFNO1lBQUVGLFFBQVE7UUFBTztJQUN6QjtJQUNBLE9BQU9xQjtBQUNUIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vbXktdjAtcHJvamVjdC8uL2xpYi9vcmRlcnMudHM/NDBlZiJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBsaWIvb3JkZXJzLnRzXG5pbXBvcnQgeyBwcmlzbWEgfSBmcm9tICdAL2xpYi9wcmlzbWEnXG5pbXBvcnQgeyBzZW5kRW1haWwgfSBmcm9tICdAL2xpYi9tYWlsZXInIC8vIHNpbmdsZSBtYWlsIHBhdGggd2l0aCBjb25zb2xlIGZhbGxiYWNrXG5cbi8qKiBCdWlsZCBhIHJlYWRhYmxlIG9yZGVyIGNvZGUsIGUuZy4gU0NHLUJWSS0yMDI1MTAyMS0wMDA3IChkYXRlICsgZGFpbHkgc2VxdWVuY2UpICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVPcmRlckNvZGUoanVyaXNkaWN0aW9uOiBzdHJpbmcpIHtcbiAgY29uc3QgaiA9IChqdXJpc2RpY3Rpb24gfHwgJ0JWSScpLnRvVXBwZXJDYXNlKClcbiAgY29uc3QgdG9kYXkgPSBuZXcgRGF0ZSgpXG4gIGNvbnN0IHkgPSB0b2RheS5nZXRGdWxsWWVhcigpXG4gIGNvbnN0IG0gPSBTdHJpbmcodG9kYXkuZ2V0TW9udGgoKSArIDEpLnBhZFN0YXJ0KDIsICcwJylcbiAgY29uc3QgZCA9IFN0cmluZyh0b2RheS5nZXREYXRlKCkpLnBhZFN0YXJ0KDIsICcwJylcblxuICAvLyBDb3VudCB0b2RheSdzIG9yZGVycyB0byBjcmVhdGUgYSBzZXF1ZW5jZSBudW1iZXJcbiAgY29uc3Qgc3RhcnQgPSBuZXcgRGF0ZShEYXRlLlVUQyh5LCB0b2RheS5nZXRNb250aCgpLCB0b2RheS5nZXREYXRlKCksIDAsIDAsIDApKVxuICBjb25zdCBlbmQgPSBuZXcgRGF0ZShEYXRlLlVUQyh5LCB0b2RheS5nZXRNb250aCgpLCB0b2RheS5nZXREYXRlKCkgKyAxLCAwLCAwLCAwKSlcbiAgY29uc3QgY291bnRUb2RheSA9IGF3YWl0IHByaXNtYS5vcmRlci5jb3VudCh7XG4gICAgd2hlcmU6IHsgY3JlYXRlZEF0OiB7IGd0ZTogc3RhcnQsIGx0OiBlbmQgfSB9LFxuICB9KVxuXG4gIGNvbnN0IHNlcSA9IFN0cmluZyhjb3VudFRvZGF5ICsgMSkucGFkU3RhcnQoNCwgJzAnKVxuICByZXR1cm4gYFNDRy0ke2p9LSR7eX0ke219JHtkfS0ke3NlcX1gXG59XG5cbi8qKlxuICogRW5zdXJlIHRoZXJlIGlzIG9uZSBwZW5kaW5nIG9yZGVyIGZvciB0aGlzIG9uYm9hcmRpbmcuXG4gKiBJZiBub25lIGV4aXN0cywgY3JlYXRlIG9uZSBhbmQgc2VuZCAob3Igc2ltdWxhdGUpIHRoZSBlbWFpbC5cbiAqIFRoaXMgZnVuY3Rpb24gbXVzdCBOT1QgdGhyb3cgaWYgZW1haWwgZmFpbHMuXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBlbnN1cmVQZW5kaW5nT3JkZXIob3B0czoge1xuICB1c2VySWQ6IHN0cmluZ1xuICB1c2VyRW1haWw6IHN0cmluZ1xuICBvbmJvYXJkaW5nSWQ6IHN0cmluZ1xuICBqdXJpc2RpY3Rpb246IHN0cmluZ1xuICBjb21wYW55TmFtZXM/OiB7IGZpcnN0UHJlZmVyZW5jZT86IHN0cmluZzsgY2hvc2VuRW5kaW5nPzogc3RyaW5nIH0gfCBhbnlcbiAgcHJpY2luZ1VybDogc3RyaW5nXG59KSB7XG4gIGNvbnN0IHsgdXNlcklkLCB1c2VyRW1haWwsIG9uYm9hcmRpbmdJZCwganVyaXNkaWN0aW9uLCBjb21wYW55TmFtZXMsIHByaWNpbmdVcmwgfSA9IG9wdHNcblxuICAvLyAxKSBGaW5kIGV4aXN0aW5nIHBlbmRpbmcgb3JkZXJcbiAgbGV0IG9yZGVyID0gYXdhaXQgcHJpc21hLm9yZGVyLmZpbmRGaXJzdCh7XG4gICAgd2hlcmU6IHsgb25ib2FyZGluZ0lkLCBzdGF0dXM6ICdwZW5kaW5nX3BheW1lbnQnIH0sXG4gIH0pXG5cbiAgLy8gMikgQ3JlYXRlIGlmIG5vdCBmb3VuZFxuICBpZiAoIW9yZGVyKSB7XG4gICAgb3JkZXIgPSBhd2FpdCBwcmlzbWEub3JkZXIuY3JlYXRlKHtcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgdXNlcklkLFxuICAgICAgICBvbmJvYXJkaW5nSWQsXG4gICAgICAgIGp1cmlzZGljdGlvbjoganVyaXNkaWN0aW9uIHx8ICdCVkknLFxuICAgICAgICBvcmRlckNvZGU6IGF3YWl0IGdlbmVyYXRlT3JkZXJDb2RlKGp1cmlzZGljdGlvbiksXG4gICAgICAgIHN0YXR1czogJ3BlbmRpbmdfcGF5bWVudCcsXG4gICAgICB9LFxuICAgIH0pXG4gIH1cblxuICAvLyAzKSBFbWFpbCAoY29uc29sZSBmYWxsYmFjayBpcyBpbnNpZGUgc2VuZEVtYWlsKVxuICBjb25zdCBwcmVmZXJyZWQgPVxuICAgIGNvbXBhbnlOYW1lcz8uZmlyc3RQcmVmZXJlbmNlXG4gICAgICA/IGAke2NvbXBhbnlOYW1lcy5maXJzdFByZWZlcmVuY2V9JHtjb21wYW55TmFtZXM/LmNob3NlbkVuZGluZyA/ICcgJyArIGNvbXBhbnlOYW1lcy5jaG9zZW5FbmRpbmcgOiAnJ31gXG4gICAgICA6ICd5b3VyIGNvbXBhbnknXG5cbiAgY29uc3Qgc3ViamVjdCA9IGBTQ0cg4oCUIENvbXBsZXRlIHlvdXIgb3JkZXIgJHtvcmRlci5vcmRlckNvZGV9YFxuICBjb25zdCBodG1sID0gYFxuICAgIDxkaXYgc3R5bGU9XCJmb250LWZhbWlseTogc3lzdGVtLXVpLCAtYXBwbGUtc3lzdGVtLCBTZWdvZSBVSSwgUm9ib3RvLCBBcmlhbDsgbGluZS1oZWlnaHQ6MS42XCI+XG4gICAgICA8aDI+Q29tcGxldGUgeW91ciBvcmRlcjwvaDI+XG4gICAgICA8cD5PcmRlciBDb2RlOiA8c3Ryb25nPiR7b3JkZXIub3JkZXJDb2RlfTwvc3Ryb25nPjwvcD5cbiAgICAgIDxwPkp1cmlzZGljdGlvbjogPHN0cm9uZz4keyhqdXJpc2RpY3Rpb24gfHwgJ0JWSScpLnRvVXBwZXJDYXNlKCl9PC9zdHJvbmc+PC9wPlxuICAgICAgPHA+Q29tcGFueSBuYW1lIChmaXJzdCBwcmVmZXJlbmNlKTogPHN0cm9uZz4ke3ByZWZlcnJlZH08L3N0cm9uZz48L3A+XG4gICAgICA8cD5QbGVhc2UgY29tcGxldGUgeW91ciBwYXltZW50IHRvIHByb2NlZWQ6PC9wPlxuICAgICAgPHA+PGEgaHJlZj1cIiR7cHJpY2luZ1VybH1cIiB0YXJnZXQ9XCJfYmxhbmtcIiByZWw9XCJub29wZW5lclwiPkdvIHRvIHBheW1lbnQ8L2E+PC9wPlxuICAgICAgPGhyLz5cbiAgICAgIDxwPklmIHlvdSBhbHJlYWR5IHBhaWQsIHlvdSBjYW4gaWdub3JlIHRoaXMgZW1haWwuPC9wPlxuICAgIDwvZGl2PlxuICBgXG5cbiAgdHJ5IHtcbiAgICBhd2FpdCBzZW5kRW1haWwoe1xuICAgICAgdG86IHVzZXJFbWFpbCxcbiAgICAgIGZyb206IHByb2Nlc3MuZW52LkVNQUlMX0ZST00sIC8vIG9rIGlmIHVuZGVmaW5lZDsgc2VuZEVtYWlsIHByaW50cyB0byBjb25zb2xlIHdpdGhvdXQgY3JlZHNcbiAgICAgIHN1YmplY3QsXG4gICAgICBodG1sLFxuICAgIH0pXG4gIH0gY2F0Y2ggKGUpIHtcbiAgICAvLyBOZXZlciBibG9jayBvcmRlciBjcmVhdGlvbiBvbiBlbWFpbCBmYWlsdXJlXG4gICAgY29uc29sZS53YXJuKCdbZW5zdXJlUGVuZGluZ09yZGVyXSBlbWFpbCBzZW5kIGZhaWxlZCwgY29udGludWluZzonLCBlKVxuICB9XG5cbiAgLy8gNCkgUmVjb3JkIGxhc3RFbWFpbEF0IChldmVuIGlmIHNlbmRFbWFpbCBvbmx5IHByaW50ZWQgdG8gY29uc29sZSlcbiAgYXdhaXQgcHJpc21hLm9yZGVyLnVwZGF0ZSh7XG4gICAgd2hlcmU6IHsgaWQ6IG9yZGVyLmlkIH0sXG4gICAgZGF0YTogeyBsYXN0RW1haWxBdDogbmV3IERhdGUoKSB9LFxuICB9KVxuXG4gIHJldHVybiBvcmRlclxufVxuXG4vKiogTWFyayBhcyBwYWlkIGJ5IG9uYm9hcmRpbmdJZCAodXNlZCBieSAvcHJpY2luZyBwYWdlKSAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIG1hcmtPcmRlclBhaWRCeU9uYm9hcmRpbmcob25ib2FyZGluZ0lkOiBzdHJpbmcpIHtcbiAgY29uc3Qgb3JkZXIgPSBhd2FpdCBwcmlzbWEub3JkZXIuZmluZEZpcnN0KHtcbiAgICB3aGVyZTogeyBvbmJvYXJkaW5nSWQsIHN0YXR1czogJ3BlbmRpbmdfcGF5bWVudCcgfSxcbiAgfSlcbiAgaWYgKCFvcmRlcikgcmV0dXJuIG51bGxcblxuICBjb25zdCB1cGRhdGVkID0gYXdhaXQgcHJpc21hLm9yZGVyLnVwZGF0ZSh7XG4gICAgd2hlcmU6IHsgaWQ6IG9yZGVyLmlkIH0sXG4gICAgZGF0YTogeyBzdGF0dXM6ICdwYWlkJyB9LFxuICB9KVxuICByZXR1cm4gdXBkYXRlZFxufVxuIl0sIm5hbWVzIjpbInByaXNtYSIsInNlbmRFbWFpbCIsImdlbmVyYXRlT3JkZXJDb2RlIiwianVyaXNkaWN0aW9uIiwiaiIsInRvVXBwZXJDYXNlIiwidG9kYXkiLCJEYXRlIiwieSIsImdldEZ1bGxZZWFyIiwibSIsIlN0cmluZyIsImdldE1vbnRoIiwicGFkU3RhcnQiLCJkIiwiZ2V0RGF0ZSIsInN0YXJ0IiwiVVRDIiwiZW5kIiwiY291bnRUb2RheSIsIm9yZGVyIiwiY291bnQiLCJ3aGVyZSIsImNyZWF0ZWRBdCIsImd0ZSIsImx0Iiwic2VxIiwiZW5zdXJlUGVuZGluZ09yZGVyIiwib3B0cyIsInVzZXJJZCIsInVzZXJFbWFpbCIsIm9uYm9hcmRpbmdJZCIsImNvbXBhbnlOYW1lcyIsInByaWNpbmdVcmwiLCJmaW5kRmlyc3QiLCJzdGF0dXMiLCJjcmVhdGUiLCJkYXRhIiwib3JkZXJDb2RlIiwicHJlZmVycmVkIiwiZmlyc3RQcmVmZXJlbmNlIiwiY2hvc2VuRW5kaW5nIiwic3ViamVjdCIsImh0bWwiLCJ0byIsImZyb20iLCJwcm9jZXNzIiwiZW52IiwiRU1BSUxfRlJPTSIsImUiLCJjb25zb2xlIiwid2FybiIsInVwZGF0ZSIsImlkIiwibGFzdEVtYWlsQXQiLCJtYXJrT3JkZXJQYWlkQnlPbmJvYXJkaW5nIiwidXBkYXRlZCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/orders.ts\n");

/***/ }),

/***/ "(rsc)/./lib/prisma.ts":
/*!***********************!*\
  !*** ./lib/prisma.ts ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   prisma: () => (/* binding */ prisma)\n/* harmony export */ });\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @prisma/client */ \"@prisma/client\");\n/* harmony import */ var _prisma_client__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_prisma_client__WEBPACK_IMPORTED_MODULE_0__);\n// lib/prisma.ts\n\nconst globalForPrisma = globalThis;\nconst prisma = globalForPrisma.prisma ?? new _prisma_client__WEBPACK_IMPORTED_MODULE_0__.PrismaClient();\nif (true) globalForPrisma.prisma = prisma;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvcHJpc21hLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLGdCQUFnQjtBQUM2QjtBQUU3QyxNQUFNQyxrQkFBa0JDO0FBSWpCLE1BQU1DLFNBQVNGLGdCQUFnQkUsTUFBTSxJQUFJLElBQUlILHdEQUFZQSxHQUFFO0FBRWxFLElBQUlJLElBQXlCLEVBQWNILGdCQUFnQkUsTUFBTSxHQUFHQSIsInNvdXJjZXMiOlsid2VicGFjazovL215LXYwLXByb2plY3QvLi9saWIvcHJpc21hLnRzPzk4MjIiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gbGliL3ByaXNtYS50c1xuaW1wb3J0IHsgUHJpc21hQ2xpZW50IH0gZnJvbSAnQHByaXNtYS9jbGllbnQnXG5cbmNvbnN0IGdsb2JhbEZvclByaXNtYSA9IGdsb2JhbFRoaXMgYXMgdW5rbm93biBhcyB7XG4gIHByaXNtYTogUHJpc21hQ2xpZW50IHwgdW5kZWZpbmVkXG59XG5cbmV4cG9ydCBjb25zdCBwcmlzbWEgPSBnbG9iYWxGb3JQcmlzbWEucHJpc21hID8/IG5ldyBQcmlzbWFDbGllbnQoKVxuXG5pZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICdwcm9kdWN0aW9uJykgZ2xvYmFsRm9yUHJpc21hLnByaXNtYSA9IHByaXNtYSJdLCJuYW1lcyI6WyJQcmlzbWFDbGllbnQiLCJnbG9iYWxGb3JQcmlzbWEiLCJnbG9iYWxUaGlzIiwicHJpc21hIiwicHJvY2VzcyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/prisma.ts\n");

/***/ }),

/***/ "(rsc)/./lib/prospects.ts":
/*!**************************!*\
  !*** ./lib/prospects.ts ***!
  \**************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   normalizeCompanyName: () => (/* binding */ normalizeCompanyName),\n/* harmony export */   upsertProspect: () => (/* binding */ upsertProspect)\n/* harmony export */ });\n/* harmony import */ var _lib_prisma__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/prisma */ \"(rsc)/./lib/prisma.ts\");\n// lib/prospects.ts\n\nfunction normalizeCompanyName(raw) {\n    if (!raw) return \"\";\n    // Example normalization: upper, trim, strip spaces & punctuation commonly found in names\n    return raw.toUpperCase().trim().replace(/\\s+/g, \"\") // remove all whitespace\n    .replace(/[^\\w]/g, \"\") // remove non-alphanumerics/underscore\n    ;\n}\nasync function upsertProspect(input) {\n    const { userId, rawName, jurisdiction, onboardingId, notes } = input;\n    const normalizedName = normalizeCompanyName(rawName);\n    const j = jurisdiction || null;\n    if (!userId || !normalizedName) return null;\n    try {\n        const prospect = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.prospect.upsert({\n            where: {\n                // Prisma requires a named unique constraint; match your @@unique:\n                userId_normalizedName_jurisdiction: {\n                    userId,\n                    normalizedName,\n                    jurisdiction: j ?? undefined\n                }\n            },\n            create: {\n                userId,\n                rawName: rawName.trim(),\n                normalizedName,\n                jurisdiction: j,\n                onboardingId: onboardingId ?? null,\n                status: \"new\",\n                notes: notes ?? null\n            },\n            update: {\n                rawName: rawName.trim(),\n                onboardingId: onboardingId ?? null,\n                jurisdiction: j,\n                notes: notes ?? undefined\n            }\n        });\n        return prospect;\n    } catch (err) {\n        // If the \"undefined for null unique\" is touchy, we can fallback to find + update:\n        if (err?.code === \"P2002\") {\n            const found = await _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.prospect.findFirst({\n                where: {\n                    userId,\n                    normalizedName,\n                    jurisdiction: j\n                }\n            });\n            if (found) {\n                return _lib_prisma__WEBPACK_IMPORTED_MODULE_0__.prisma.prospect.update({\n                    where: {\n                        id: found.id\n                    },\n                    data: {\n                        rawName: rawName.trim(),\n                        onboardingId: onboardingId ?? null,\n                        notes: notes ?? undefined\n                    }\n                });\n            }\n        }\n        console.warn(\"[upsertProspect] warning:\", err);\n        return null;\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvcHJvc3BlY3RzLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLG1CQUFtQjtBQUNrQjtBQUU5QixTQUFTQyxxQkFBcUJDLEdBQVc7SUFDOUMsSUFBSSxDQUFDQSxLQUFLLE9BQU87SUFDakIseUZBQXlGO0lBQ3pGLE9BQU9BLElBQ0pDLFdBQVcsR0FDWEMsSUFBSSxHQUNKQyxPQUFPLENBQUMsUUFBUSxJQUFVLHdCQUF3QjtLQUNsREEsT0FBTyxDQUFDLFVBQVUsSUFBUSxzQ0FBc0M7O0FBQ3JFO0FBVU8sZUFBZUMsZUFBZUMsS0FBMEI7SUFDN0QsTUFBTSxFQUFFQyxNQUFNLEVBQUVDLE9BQU8sRUFBRUMsWUFBWSxFQUFFQyxZQUFZLEVBQUVDLEtBQUssRUFBRSxHQUFHTDtJQUMvRCxNQUFNTSxpQkFBaUJaLHFCQUFxQlE7SUFDNUMsTUFBTUssSUFBSUosZ0JBQWdCO0lBRTFCLElBQUksQ0FBQ0YsVUFBVSxDQUFDSyxnQkFBZ0IsT0FBTztJQUV2QyxJQUFJO1FBQ0YsTUFBTUUsV0FBVyxNQUFNZiwrQ0FBTUEsQ0FBQ2UsUUFBUSxDQUFDQyxNQUFNLENBQUM7WUFDNUNDLE9BQU87Z0JBQ0wsa0VBQWtFO2dCQUNsRUMsb0NBQW9DO29CQUNsQ1Y7b0JBQ0FLO29CQUNBSCxjQUFjSSxLQUFLSztnQkFDckI7WUFDRjtZQUNBQyxRQUFRO2dCQUNOWjtnQkFDQUMsU0FBU0EsUUFBUUwsSUFBSTtnQkFDckJTO2dCQUNBSCxjQUFjSTtnQkFDZEgsY0FBY0EsZ0JBQWdCO2dCQUM5QlUsUUFBUTtnQkFDUlQsT0FBT0EsU0FBUztZQUNsQjtZQUNBVSxRQUFRO2dCQUNOYixTQUFTQSxRQUFRTCxJQUFJO2dCQUNyQk8sY0FBY0EsZ0JBQWdCO2dCQUM5QkQsY0FBY0k7Z0JBQ2RGLE9BQU9BLFNBQVNPO1lBQ2xCO1FBQ0Y7UUFDQSxPQUFPSjtJQUNULEVBQUUsT0FBT1EsS0FBVTtRQUNqQixrRkFBa0Y7UUFDbEYsSUFBSUEsS0FBS0MsU0FBUyxTQUFTO1lBQ3pCLE1BQU1DLFFBQVEsTUFBTXpCLCtDQUFNQSxDQUFDZSxRQUFRLENBQUNXLFNBQVMsQ0FBQztnQkFDNUNULE9BQU87b0JBQUVUO29CQUFRSztvQkFBZ0JILGNBQWNJO2dCQUFFO1lBQ25EO1lBQ0EsSUFBSVcsT0FBTztnQkFDVCxPQUFPekIsK0NBQU1BLENBQUNlLFFBQVEsQ0FBQ08sTUFBTSxDQUFDO29CQUM1QkwsT0FBTzt3QkFBRVUsSUFBSUYsTUFBTUUsRUFBRTtvQkFBQztvQkFDdEJDLE1BQU07d0JBQ0puQixTQUFTQSxRQUFRTCxJQUFJO3dCQUNyQk8sY0FBY0EsZ0JBQWdCO3dCQUM5QkMsT0FBT0EsU0FBU087b0JBQ2xCO2dCQUNGO1lBQ0Y7UUFDRjtRQUNBVSxRQUFRQyxJQUFJLENBQUMsNkJBQTZCUDtRQUMxQyxPQUFPO0lBQ1Q7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL215LXYwLXByb2plY3QvLi9saWIvcHJvc3BlY3RzLnRzPzNiMzIiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gbGliL3Byb3NwZWN0cy50c1xuaW1wb3J0IHsgcHJpc21hIH0gZnJvbSAnQC9saWIvcHJpc21hJ1xuXG5leHBvcnQgZnVuY3Rpb24gbm9ybWFsaXplQ29tcGFueU5hbWUocmF3OiBzdHJpbmcpOiBzdHJpbmcge1xuICBpZiAoIXJhdykgcmV0dXJuICcnXG4gIC8vIEV4YW1wbGUgbm9ybWFsaXphdGlvbjogdXBwZXIsIHRyaW0sIHN0cmlwIHNwYWNlcyAmIHB1bmN0dWF0aW9uIGNvbW1vbmx5IGZvdW5kIGluIG5hbWVzXG4gIHJldHVybiByYXdcbiAgICAudG9VcHBlckNhc2UoKVxuICAgIC50cmltKClcbiAgICAucmVwbGFjZSgvXFxzKy9nLCAnJykgICAgICAgLy8gcmVtb3ZlIGFsbCB3aGl0ZXNwYWNlXG4gICAgLnJlcGxhY2UoL1teXFx3XS9nLCAnJykgICAgIC8vIHJlbW92ZSBub24tYWxwaGFudW1lcmljcy91bmRlcnNjb3JlXG59XG5cbnR5cGUgVXBzZXJ0UHJvc3BlY3RJbnB1dCA9IHtcbiAgdXNlcklkOiBzdHJpbmdcbiAgcmF3TmFtZTogc3RyaW5nXG4gIGp1cmlzZGljdGlvbj86IHN0cmluZyB8IG51bGxcbiAgb25ib2FyZGluZ0lkPzogc3RyaW5nIHwgbnVsbFxuICBub3Rlcz86IHN0cmluZyB8IG51bGxcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHVwc2VydFByb3NwZWN0KGlucHV0OiBVcHNlcnRQcm9zcGVjdElucHV0KSB7XG4gIGNvbnN0IHsgdXNlcklkLCByYXdOYW1lLCBqdXJpc2RpY3Rpb24sIG9uYm9hcmRpbmdJZCwgbm90ZXMgfSA9IGlucHV0XG4gIGNvbnN0IG5vcm1hbGl6ZWROYW1lID0gbm9ybWFsaXplQ29tcGFueU5hbWUocmF3TmFtZSlcbiAgY29uc3QgaiA9IGp1cmlzZGljdGlvbiB8fCBudWxsXG5cbiAgaWYgKCF1c2VySWQgfHwgIW5vcm1hbGl6ZWROYW1lKSByZXR1cm4gbnVsbFxuXG4gIHRyeSB7XG4gICAgY29uc3QgcHJvc3BlY3QgPSBhd2FpdCBwcmlzbWEucHJvc3BlY3QudXBzZXJ0KHtcbiAgICAgIHdoZXJlOiB7XG4gICAgICAgIC8vIFByaXNtYSByZXF1aXJlcyBhIG5hbWVkIHVuaXF1ZSBjb25zdHJhaW50OyBtYXRjaCB5b3VyIEBAdW5pcXVlOlxuICAgICAgICB1c2VySWRfbm9ybWFsaXplZE5hbWVfanVyaXNkaWN0aW9uOiB7XG4gICAgICAgICAgdXNlcklkLFxuICAgICAgICAgIG5vcm1hbGl6ZWROYW1lLFxuICAgICAgICAgIGp1cmlzZGljdGlvbjogaiA/PyB1bmRlZmluZWQsIC8vIHVuZGVmaW5lZCB3aGVuIHVuaXF1ZSBmaWVsZCBhbGxvd3MgbnVsbDsgYWRqdXN0IGlmIG5lZWRlZFxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIGNyZWF0ZToge1xuICAgICAgICB1c2VySWQsXG4gICAgICAgIHJhd05hbWU6IHJhd05hbWUudHJpbSgpLFxuICAgICAgICBub3JtYWxpemVkTmFtZSxcbiAgICAgICAganVyaXNkaWN0aW9uOiBqLFxuICAgICAgICBvbmJvYXJkaW5nSWQ6IG9uYm9hcmRpbmdJZCA/PyBudWxsLFxuICAgICAgICBzdGF0dXM6ICduZXcnLFxuICAgICAgICBub3Rlczogbm90ZXMgPz8gbnVsbCxcbiAgICAgIH0sXG4gICAgICB1cGRhdGU6IHtcbiAgICAgICAgcmF3TmFtZTogcmF3TmFtZS50cmltKCksXG4gICAgICAgIG9uYm9hcmRpbmdJZDogb25ib2FyZGluZ0lkID8/IG51bGwsXG4gICAgICAgIGp1cmlzZGljdGlvbjogaixcbiAgICAgICAgbm90ZXM6IG5vdGVzID8/IHVuZGVmaW5lZCxcbiAgICAgIH0sXG4gICAgfSlcbiAgICByZXR1cm4gcHJvc3BlY3RcbiAgfSBjYXRjaCAoZXJyOiBhbnkpIHtcbiAgICAvLyBJZiB0aGUgXCJ1bmRlZmluZWQgZm9yIG51bGwgdW5pcXVlXCIgaXMgdG91Y2h5LCB3ZSBjYW4gZmFsbGJhY2sgdG8gZmluZCArIHVwZGF0ZTpcbiAgICBpZiAoZXJyPy5jb2RlID09PSAnUDIwMDInKSB7XG4gICAgICBjb25zdCBmb3VuZCA9IGF3YWl0IHByaXNtYS5wcm9zcGVjdC5maW5kRmlyc3Qoe1xuICAgICAgICB3aGVyZTogeyB1c2VySWQsIG5vcm1hbGl6ZWROYW1lLCBqdXJpc2RpY3Rpb246IGogfSxcbiAgICAgIH0pXG4gICAgICBpZiAoZm91bmQpIHtcbiAgICAgICAgcmV0dXJuIHByaXNtYS5wcm9zcGVjdC51cGRhdGUoe1xuICAgICAgICAgIHdoZXJlOiB7IGlkOiBmb3VuZC5pZCB9LFxuICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHJhd05hbWU6IHJhd05hbWUudHJpbSgpLFxuICAgICAgICAgICAgb25ib2FyZGluZ0lkOiBvbmJvYXJkaW5nSWQgPz8gbnVsbCxcbiAgICAgICAgICAgIG5vdGVzOiBub3RlcyA/PyB1bmRlZmluZWQsXG4gICAgICAgICAgfSxcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICB9XG4gICAgY29uc29sZS53YXJuKCdbdXBzZXJ0UHJvc3BlY3RdIHdhcm5pbmc6JywgZXJyKVxuICAgIHJldHVybiBudWxsXG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJwcmlzbWEiLCJub3JtYWxpemVDb21wYW55TmFtZSIsInJhdyIsInRvVXBwZXJDYXNlIiwidHJpbSIsInJlcGxhY2UiLCJ1cHNlcnRQcm9zcGVjdCIsImlucHV0IiwidXNlcklkIiwicmF3TmFtZSIsImp1cmlzZGljdGlvbiIsIm9uYm9hcmRpbmdJZCIsIm5vdGVzIiwibm9ybWFsaXplZE5hbWUiLCJqIiwicHJvc3BlY3QiLCJ1cHNlcnQiLCJ3aGVyZSIsInVzZXJJZF9ub3JtYWxpemVkTmFtZV9qdXJpc2RpY3Rpb24iLCJ1bmRlZmluZWQiLCJjcmVhdGUiLCJzdGF0dXMiLCJ1cGRhdGUiLCJlcnIiLCJjb2RlIiwiZm91bmQiLCJmaW5kRmlyc3QiLCJpZCIsImRhdGEiLCJjb25zb2xlIiwid2FybiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/prospects.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@auth","vendor-chunks/next-auth","vendor-chunks/jose","vendor-chunks/oauth4webapi","vendor-chunks/bcryptjs","vendor-chunks/preact","vendor-chunks/preact-render-to-string","vendor-chunks/@panva","vendor-chunks/svix","vendor-chunks/resend","vendor-chunks/uuid","vendor-chunks/fast-sha256","vendor-chunks/@stablelib"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcompany-incorporation%2Fdraft%2Froute&page=%2Fapi%2Fcompany-incorporation%2Fdraft%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcompany-incorporation%2Fdraft%2Froute.ts&appDir=%2FUsers%2Fphraewaphuriyaphan%2FDesktop%2FSynergy_updatedform%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fphraewaphuriyaphan%2FDesktop%2FSynergy_updatedform&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();